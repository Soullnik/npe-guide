import{a as v,b as ye}from"./chunk-7CQUICK7.js";import{b as G,d as he}from"./chunk-A2QYPOYP.js";import{a as X,da as Q,e as Le,ea as Be,k as J,l as Ue,m as K,o as Re}from"./chunk-XYWTDT3T.js";import{a as P,f as xe}from"./chunk-TTEXIRIC.js";import{c as I,d as be}from"./chunk-YZFDUSX3.js";import{c as D,d as ge}from"./chunk-2AUPWM7R.js";import{a as C,b as V}from"./chunk-MEUTOEEX.js";import{a as z,e as U}from"./chunk-FAF55DAL.js";var Ce,ve,we,_,F,M,Oe,je,Y=U(()=>{"use strict";Ce=(e,n)=>e.endsWith(n),ve=(e,n)=>e?e.startsWith(n):!1,we=e=>{if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let n="";for(let t=0;t<e.byteLength;t++)n+=String.fromCharCode(e[t]);return n},_=e=>{let n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t="",a,c,o,f,l,d,p,s=0,r=ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e);for(;s<r.length;)a=r[s++],c=s<r.length?r[s++]:Number.NaN,o=s<r.length?r[s++]:Number.NaN,f=a>>2,l=(a&3)<<4|c>>4,d=(c&15)<<2|o>>6,p=o&63,isNaN(c)?d=p=64:isNaN(o)&&(p=64),t+=n.charAt(f)+n.charAt(l)+n.charAt(d)+n.charAt(p);return t},F=e=>atob(e),M=e=>{let n=F(e),t=n.length,a=new Uint8Array(new ArrayBuffer(t));for(let c=0;c<t;c++)a[c]=n.charCodeAt(c);return a.buffer},Oe=(e,n)=>{let t=String(e);for(;t.length<n;)t="0"+t;return t},je={EndsWith:Ce,StartsWith:ve,Decode:we,EncodeArrayBufferToBase64:_,DecodeBase64ToString:F,DecodeBase64ToBinary:M,PadNumber:Oe}});var He,Ee=U(()=>{"use strict";V();he();He=(()=>{class e{static Instantiate(t){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[t])return this.RegisteredExternalClasses[t];let a=G(t);if(a)return a;C.Warn(t+" not found, you may have missed an import.");let c=t.split("."),o=window||this;for(let f=0,l=c.length;f<l;f++)o=o[c[f]];return typeof o!="function"?null:o}}return e.RegisteredExternalClasses={},e})()});var w,Z=U(()=>{"use strict";w=(()=>{class e{}return e.FilesToLoad={},e})()});var j,ee=U(()=>{"use strict";j=class{static ExponentialBackoff(n=3,t=500){return(a,c,o)=>c.status!==0||o>=n||a.indexOf("file:")!==-1?-1:Math.pow(2,o)*t}}});var b,q,R,te,re=U(()=>{"use strict";b=class extends Error{};b._setPrototypeOf=Object.setPrototypeOf||((e,n)=>(e.__proto__=n,e));q={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002},R=class e extends b{constructor(n,t,a){super(n),this.errorCode=t,this.innerError=a,this.name="RuntimeError",b._setPrototypeOf(this,e.prototype)}},te=class e extends b{constructor(n="Operation aborted"){super(n),this.name="AbortError",b._setPrototypeOf(this,e.prototype)}}});function fe(e){return M(e.split(",")[1])}var se,k,A,W,Se,g,oe,ne,ae,$,E,ie,rt,le,Te,ce,de,De,O,Ie,Fe=U(()=>{"use strict";ye();xe();ge();Z();ee();re();Y();Ue();be();V();Re();Le();Be();se=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i),k=class e extends R{constructor(n,t){super(n,q.LoadFileError),this.name="LoadFileError",b._setPrototypeOf(this,e.prototype),t instanceof v?this.request=t:this.file=t}},A=class e extends R{constructor(n,t){super(n,q.RequestFileError),this.request=t,this.name="RequestFileError",b._setPrototypeOf(this,e.prototype)}},W=class e extends R{constructor(n,t){super(n,q.ReadFileError),this.file=t,this.name="ReadFileError",b._setPrototypeOf(this,e.prototype)}},Se=e=>(e=e.replace(/#/gm,"%23"),e),g={DefaultRetryStrategy:j.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:e=>e,ScriptBaseUrl:"",ScriptPreprocessUrl:e=>e,CleanUrl:Se},oe=(e,n)=>{if(!(e&&e.indexOf("data:")===0)&&g.CorsBehavior)if(typeof g.CorsBehavior=="string"||g.CorsBehavior instanceof String)n.crossOrigin=g.CorsBehavior;else{let t=g.CorsBehavior(e);t&&(n.crossOrigin=t)}},ne={getRequiredSize:null},ae=(e,n,t,a,c="",o,f=I.LastCreatedEngine)=>{if(typeof HTMLImageElement>"u"&&!f?._features.forceBitmapOverHTMLImageElement)return t("LoadImage is only supported in web or BabylonNative environments."),null;let l,d=!1;e instanceof ArrayBuffer||ArrayBuffer.isView(e)?typeof Blob<"u"&&typeof URL<"u"?(l=URL.createObjectURL(new Blob([e],{type:c})),d=!0):l=`data:${c};base64,`+_(e):e instanceof Blob?(l=URL.createObjectURL(e),d=!0):(l=g.CleanUrl(e),l=g.PreprocessUrl(l));let p=i=>{if(t){let u=l||e.toString();t(`Error while trying to load image: ${u.indexOf("http")===0||u.length<=128?u:u.slice(0,128)+"..."}`,i)}};if(f?._features.forceBitmapOverHTMLImageElement)return E(l,i=>{f.createImageBitmap(new Blob([i],{type:c}),z({premultiplyAlpha:"none"},o)).then(u=>{n(u),d&&URL.revokeObjectURL(l)}).catch(u=>{t&&t("Error while trying to load image: "+e,u)})},void 0,a||void 0,!0,(i,u)=>{p(u)}),null;let s=new Image;if(ne.getRequiredSize){let i=ne.getRequiredSize(e);i.width&&(s.width=i.width),i.height&&(s.height=i.height)}oe(l,s);let r=[],h=()=>{for(let i of r)i.target.addEventListener(i.name,i.handler)},m=()=>{for(let i of r)i.target.removeEventListener(i.name,i.handler);r.length=0},S=()=>{m(),n(s),d&&s.src&&URL.revokeObjectURL(s.src)},x=i=>{m(),p(i),d&&s.src&&URL.revokeObjectURL(s.src)},T=i=>{if(i.blockedURI!==s.src||i.disposition==="report")return;m();let u=new Error(`CSP violation of policy ${i.effectiveDirective} ${i.blockedURI}. Current policy is ${i.originalPolicy}`);I.UseFallbackTexture=!1,p(u),d&&s.src&&URL.revokeObjectURL(s.src),s.src=""};r.push({target:s,name:"load",handler:S}),r.push({target:s,name:"error",handler:x}),r.push({target:document,name:"securitypolicyviolation",handler:T}),h();let B=l.substring(0,5)==="blob:",L=l.substring(0,5)==="data:",y=()=>{B||L||!v.IsCustomRequestAvailable?s.src=l:E(l,(i,u,N)=>{let ue=!c&&N?N:c,pe=new Blob([i],{type:ue}),me=URL.createObjectURL(pe);d=!0,s.src=me},void 0,a||void 0,!0,(i,u)=>{p(u)})},H=()=>{a&&a.loadImage(l,s)};if(!B&&!L&&a&&a.enableTexturesOffline)a.open(H,y);else{if(l.indexOf("file:")!==-1){let i=decodeURIComponent(l.substring(5).toLowerCase());if(w.FilesToLoad[i]&&typeof URL<"u"){try{let u;try{u=URL.createObjectURL(w.FilesToLoad[i])}catch{u=URL.createObjectURL(w.FilesToLoad[i])}s.src=u,d=!0}catch{s.src=""}return s}}y()}return s},$=(e,n,t,a,c)=>{let o=new FileReader,f={onCompleteObservable:new D,abort:()=>o.abort()};return o.onloadend=()=>f.onCompleteObservable.notifyObservers(f),c&&(o.onerror=()=>{c(new W(`Unable to read ${e.name}`,e))}),o.onload=l=>{n(l.target.result)},t&&(o.onprogress=t),a?o.readAsArrayBuffer(e):o.readAsText(e),f},E=(e,n,t,a,c,o,f)=>{if(e.name)return $(e,n,t,c,o?s=>{o(void 0,s)}:void 0);let l=e;if(l.indexOf("file:")!==-1){let s=decodeURIComponent(l.substring(5).toLowerCase());s.indexOf("./")===0&&(s=s.substring(2));let r=w.FilesToLoad[s];if(r)return $(r,n,t,c,o?h=>o(void 0,new k(h.message,h.file)):void 0)}let{match:d,type:p}=ce(l);if(d){let s={onCompleteObservable:new D,abort:()=>()=>{}};try{let r=c?fe(l):de(l);n(r,void 0,p)}catch(r){o?o(void 0,r):C.Error(r.message||"Failed to parse the Data URL")}return K.SetImmediate(()=>{s.onCompleteObservable.notifyObservers(s)}),s}return ie(l,(s,r)=>{n(s,r?.responseURL,r?.getResponseHeader("content-type"))},t,a,c,o?s=>{o(s.request,new k(s.message,s.request))}:void 0,f)},ie=(e,n,t,a,c,o,f)=>{a!==null&&(a??(a=I.LastCreatedScene?.offlineProvider)),e=g.CleanUrl(e),e=g.PreprocessUrl(e);let l=g.BaseUrl+e,d=!1,p={onCompleteObservable:new D,abort:()=>d=!0},s=()=>{let r=new v,h=null,m,S=()=>{r&&(t&&r.removeEventListener("progress",t),m&&r.removeEventListener("readystatechange",m),r.removeEventListener("loadend",x))},x=()=>{S(),p.onCompleteObservable.notifyObservers(p),p.onCompleteObservable.clear(),t=void 0,m=null,x=null,o=void 0,f=void 0,n=void 0};p.abort=()=>{d=!0,x&&x(),r&&r.readyState!==(XMLHttpRequest.DONE||4)&&r.abort(),h!==null&&(clearTimeout(h),h=null),r=null};let T=L=>{let y=L.message||"Unknown error";o&&r?o(new A(y,r)):C.Error(y)},B=L=>{if(r){if(r.open("GET",l),f)try{f(r)}catch(y){T(y);return}c&&(r.responseType="arraybuffer"),t&&r.addEventListener("progress",t),x&&r.addEventListener("loadend",x),m=()=>{if(!(d||!r)&&r.readyState===(XMLHttpRequest.DONE||4)){if(m&&r.removeEventListener("readystatechange",m),r.status>=200&&r.status<300||r.status===0&&(!P()||le())){let i=c?r.response:r.responseText;if(i!==null){try{n&&n(i,r)}catch(u){T(u)}return}}let y=g.DefaultRetryStrategy;if(y){let i=y(l,r,L);if(i!==-1){S(),r=new v,h=setTimeout(()=>B(L+1),i);return}}let H=new A("Error status: "+r.status+" "+r.statusText+" - Unable to load "+l,r);o&&o(H)}},r.addEventListener("readystatechange",m),r.send()}};B(0)};if(a&&a.enableSceneOffline&&!e.startsWith("blob:")){let r=m=>{m&&m.status>400?o&&o(m):s()},h=()=>{a&&a.loadFile(g.BaseUrl+e,m=>{!d&&n&&n(m),p.onCompleteObservable.notifyObservers(p)},t?m=>{!d&&t&&t(m)}:void 0,r,c)};a.open(h,r)}else s();return p},rt=e=>{let{match:n,type:t}=ce(e);if(n)return t||void 0;let a=e.lastIndexOf(".");switch(e.substring(a+1).toLowerCase()){case"glb":return"model/gltf-binary";case"bin":return"application/octet-stream";case"gltf":return"model/gltf+json";case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png";case"webp":return"image/webp";case"ktx":return"image/ktx";case"ktx2":return"image/ktx2";case"avif":return"image/avif";default:return}},le=()=>typeof location<"u"&&location.protocol==="file:",Te=e=>se.test(e),ce=e=>{let n=se.exec(e);return n===null||n.length===0?{match:!1,type:""}:{match:!0,type:n[0].replace("data:","").replace(";base64,","")}};de=e=>F(e.split(",")[1]),De=()=>{Q._FileToolsLoadImage=ae,X.loadFile=E,J.loadFile=E};De();Ie=(e,n,t,a,c,o,f,l,d,p)=>{O={DecodeBase64UrlToBinary:e,DecodeBase64UrlToString:n,DefaultRetryStrategy:t.DefaultRetryStrategy,BaseUrl:t.BaseUrl,CorsBehavior:t.CorsBehavior,PreprocessUrl:t.PreprocessUrl,IsBase64DataUrl:a,IsFileURL:c,LoadFile:o,LoadImage:f,ReadFile:l,RequestFile:d,SetCorsBehavior:p},Object.defineProperty(O,"DefaultRetryStrategy",{get:function(){return t.DefaultRetryStrategy},set:function(s){t.DefaultRetryStrategy=s}}),Object.defineProperty(O,"BaseUrl",{get:function(){return t.BaseUrl},set:function(s){t.BaseUrl=s}}),Object.defineProperty(O,"PreprocessUrl",{get:function(){return t.PreprocessUrl},set:function(s){t.PreprocessUrl=s}}),Object.defineProperty(O,"CorsBehavior",{get:function(){return t.CorsBehavior},set:function(s){t.CorsBehavior=s}})};Ie(fe,de,g,Te,le,E,ae,$,ie,oe)});export{w as a,Z as b,j as c,ee as d,b as e,q as f,R as g,te as h,re as i,Ce as j,ve as k,we as l,_ as m,F as n,M as o,Oe as p,je as q,Y as r,He as s,Ee as t,k as u,A as v,W as w,g as x,oe as y,ne as z,ae as A,$ as B,E as C,ie as D,rt as E,le as F,Te as G,ce as H,fe as I,de as J,O as K,Ie as L,Fe as M};
