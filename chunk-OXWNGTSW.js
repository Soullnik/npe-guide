import{C as L,D as v,aa as K,s as S,w as B}from"./chunk-SL33GJI7.js";import{a as W,b as J}from"./chunk-JZRHVK4S.js";import{b as j}from"./chunk-7WAK3VD7.js";import{b as G}from"./chunk-O6SXCXKG.js";import{b as Y}from"./chunk-EUALCU5W.js";import{b as Z}from"./chunk-AEECYACG.js";import{b as O}from"./chunk-CFG3P2H7.js";import{b as q}from"./chunk-F6VQTDND.js";import{A as b,v as c}from"./chunk-HPFLS2LJ.js";import{j as I,k as d,l as R}from"./chunk-RIAPI5OR.js";import{a as _,b as X,s as y,u as D}from"./chunk-J2REHNP7.js";import{a as x,b as E}from"./chunk-RR3YIVG4.js";import{e as g}from"./chunk-FAF55DAL.js";function ne(m,e,a,r,t=null){let o=new c(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new c(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return p.extractMinAndMaxIndexed(m,e,a,r,o,n),t&&(o.x-=o.x*t.x+t.y,o.y-=o.y*t.x+t.y,o.z-=o.z*t.x+t.y,n.x+=n.x*t.x+t.y,n.y+=n.y*t.x+t.y,n.z+=n.z*t.x+t.y),{minimum:o,maximum:n}}function T(m,e,a,r=null,t){let o=new c(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new c(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return t||(t=3),p.extractMinAndMax(m,e,a,t,o,n),r&&(o.x-=o.x*r.x+r.y,o.y-=o.y*r.x+r.y,o.z-=o.z*r.x+r.y,n.x+=n.x*r.x+r.y,n.y+=n.y*r.x+r.y,n.z+=n.z*r.x+r.y),{minimum:o,maximum:n}}function oe(m,e){let a=T(m,0,m.length/3),r=a.maximum.subtract(a.minimum).scale(.5).add(a.minimum),t=new c,o=new c,n=new c,s=new c,i=new c,f=new c,l=new c;for(let u=0;u<e.length;u+=3){let M=e[u],V=e[u+1],h=e[u+2];t.fromArray(m,M*3),o.fromArray(m,V*3),n.fromArray(m,h*3),o.subtractToRef(t,s),n.subtractToRef(t,i),c.CrossToRef(s,i,f),f.normalize();let U=t.x+o.x+n.x,k=t.y+o.y+n.y,w=t.z+o.z+n.z;l.set(U/3,k/3,w/3),l.subtractInPlace(r),l.normalize(),c.Dot(f,l)>=0&&(e[u]=h,e[u+2]=M)}}var p,N=g(()=>{"use strict";X();b();D();p=class{static extractMinAndMaxIndexed(e,a,r,t,o,n){for(let s=r;s<r+t;s++){let i=a[s]*3,f=e[i],l=e[i+1],u=e[i+2];o.minimizeInPlaceFromFloats(f,l,u),n.maximizeInPlaceFromFloats(f,l,u)}}static extractMinAndMax(e,a,r,t,o,n){for(let s=a,i=a*t;s<a+r;s++,i+=t){let f=e[i],l=e[i+1],u=e[i+2];o.minimizeInPlaceFromFloats(f,l,u),n.maximizeInPlaceFromFloats(f,l,u)}}};_([y.filter((...[m,e])=>!Array.isArray(m)&&!Array.isArray(e))],p,"extractMinAndMaxIndexed",null);_([y.filter((...[m])=>!Array.isArray(m))],p,"extractMinAndMax",null)});var F,Q,z=g(()=>{"use strict";E();O();W();q();j();G();Y();Z();J();F="gpuTransformVertexShader",Q=`attribute vec3 position;
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
out vec3 outPosition;const mat4 identity=mat4(
vec4(1.0,0.0,0.0,0.0),
vec4(0.0,1.0,0.0,0.0),
vec4(0.0,0.0,1.0,0.0),
vec4(0.0,0.0,0.0,1.0)
);void main(void) {vec3 positionUpdated=position;
#include<morphTargetsVertexGlobal>
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
mat4 finalWorld=identity;
#include<bonesVertex>
#include<bakedVertexAnimation>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);outPosition=worldPos.xyz;}`;x.ShadersStore[F]||(x.ShadersStore[F]=Q)});var P,$,C=g(()=>{"use strict";E();P="gpuTransformPixelShader",$=`#version 300 es
void main() {discard;}
`;x.ShadersStore[P]||(x.ShadersStore[P]=$)});var A,H=g(()=>{R();K();N();b();z();C();A=class m{constructor(e){this._buffers={},this._effects={},this._meshListCounter=0,this._engine=e}processAsync(e){return Array.isArray(e)||(e=[e]),this._meshListCounter=0,this._processMeshList(e),Promise.resolve()}_processMeshList(e){let a=this._engine.getCaps().parallelShaderCompile;this._engine.getCaps().parallelShaderCompile=void 0;for(let r=0;r<e.length;++r){let t=e[r];if(t.getTotalVertices()===0||!t.getVertexBuffer||!t.getVertexBuffer(d.PositionKind))continue;let n,s=[],i=[d.PositionKind];t&&t.useBones&&t.computeBonesUsingShaders&&t.skeleton?(i.push(d.MatricesIndicesKind),i.push(d.MatricesWeightsKind),t.numBoneInfluencers>4&&(i.push(d.MatricesIndicesExtraKind),i.push(d.MatricesWeightsExtraKind)),s.push("#define NUM_BONE_INFLUENCERS "+t.numBoneInfluencers),s.push("#define BONETEXTURE "+t.skeleton.isUsingTextureForMatrices),s.push("#define BonesPerMesh "+(t.skeleton.bones.length+1))):s.push("#define NUM_BONE_INFLUENCERS 0");let f=t.morphTargetManager?S(t.morphTargetManager,s,i,t,!0,!1,!1,!1,!1,!1):0,l=t.bakedVertexAnimationManager;l&&l.isEnabled&&(s.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),L(i,t,s));let u=s.join(`
`);if(this._effects[u])n=this._effects[u];else{let h={attributes:i,uniformsNames:["boneTextureWidth","mBones","morphTargetInfluences","morphTargetCount","morphTargetTextureInfo","morphTargetTextureIndices","bakedVertexAnimationSettings","bakedVertexAnimationTextureSizeInverted","bakedVertexAnimationTime"],uniformBuffersNames:[],samplers:["boneSampler","morphTargets","bakedVertexAnimationTexture"],defines:u,fallbacks:null,onCompiled:null,onError:null,indexParameters:{maxSimultaneousMorphTargets:f},maxSimultaneousLights:0,transformFeedbackVaryings:["outPosition"]};n=this._engine.createEffect("gpuTransform",h,this._engine),this._effects[u]=n}this._compute(t,n)}this._engine.getCaps().parallelShaderCompile=a}_compute(e,a){let r=this._engine,t,o=e.getTotalVertices();if(this._buffers[e.uniqueId])t=this._buffers[e.uniqueId];else{let i=new Float32Array(o*3);t=new I(e.getEngine(),i,!0,3),this._buffers[e.uniqueId]=t}a.getEngine().enableEffect(a),e._bindDirect(a,null,!0),v(e,a),B(e,a),e.morphTargetManager&&e.morphTargetManager.isUsingTextureForTargets&&e.morphTargetManager._bind(a);let n=e.bakedVertexAnimationManager;n&&n.isEnabled&&e.bakedVertexAnimationManager?.bind(a,!1);let s=t.getData();if(r.bindTransformFeedbackBuffer(t.getBuffer()),r.setRasterizerState(!1),r.beginTransformFeedback(!0),r.drawArraysType(2,0,o),r.endTransformFeedback(),r.setRasterizerState(!0),r.readTransformFeedbackBuffer(s),r.bindTransformFeedbackBuffer(null),this._meshListCounter===0)e._refreshBoundingInfo(s,null);else{let i=e.getBoundingInfo().boundingBox,f=T(s,0,o);m._Min.copyFrom(i.minimum).minimizeInPlace(f.minimum),m._Max.copyFrom(i.maximum).maximizeInPlace(f.maximum),e._refreshBoundingInfoDirect({minimum:m._Min,maximum:m._Max})}}registerMeshListAsync(e){return Array.isArray(e)||(e=[e]),this._meshList=e,this._meshListCounter=0,Promise.resolve()}processMeshList(){this._meshList.length!==0&&(this._processMeshList(this._meshList),this._meshListCounter++)}fetchResultsForMeshListAsync(){return this._meshListCounter=0,Promise.resolve()}dispose(){for(let e in this._buffers)this._buffers[e].dispose();this._buffers={},this._effects={},this._engine=null}};A._Min=new c;A._Max=new c});export{ne as a,T as b,oe as c,N as d,A as e,H as f};
