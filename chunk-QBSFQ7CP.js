import{e as x,f as C,g as L}from"./chunk-NWJN3XMT.js";import{a as h,b as R,s as A,u as W}from"./chunk-J2REHNP7.js";import{c,f as F}from"./chunk-XGXGTYYM.js";import{m as b,r as _}from"./chunk-3GZP4BR5.js";import{c as d,d as B}from"./chunk-YZFDUSX3.js";import{j as v,z as O}from"./chunk-W4M4SCHI.js";import{a as E,b as P}from"./chunk-MEUTOEEX.js";import{e as S}from"./chunk-FAF55DAL.js";async function $(){let n=d.LastCreatedEngine?.createCanvas(100,100)??new OffscreenCanvas(100,100);n instanceof OffscreenCanvas&&E.Warn("DumpData: OffscreenCanvas will be used for dumping data. This may result in lossy alpha values.");let{ThinEngine:s}=await import("./chunk-CVLEHS67.js");if(!s.IsSupported)throw new Error("DumpData: No WebGL context available. Cannot dump data.");let r={preserveDrawingBuffer:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1},e=new s(n,!1,r);d.Instances.pop(),d.OnEnginesDisposedObservable.add(i=>{e&&i!==e&&!e.isDisposed&&d.Instances.length===0&&T()}),e.getCaps().parallelShaderCompile=void 0;let o=new x(e),{passPixelShader:t}=await import("./chunk-IE6NAKAH.js"),p=new C({engine:e,name:t.name,fragmentShader:t.shader,samplerNames:["textureSampler"]});return{canvas:n,dumpEngine:{engine:e,renderer:o,wrapper:p}}}async function M(){return u||(u=$()),await u}async function I(n,s,r,e,o="image/png",t,p){let i=await r.readPixels(0,0,n,s),a=new Uint8Array(i.buffer);D(n,s,a,e,o,t,!0,void 0,p)}async function y(n,s,r,e="image/png",o,t=!1,p=!1,i){if(r instanceof Float32Array){let g=new Uint8Array(r.length),m=r.length;for(;m--;){let w=r[m];g[m]=Math.round(v(w)*255)}r=g}let a=await l.EncodeImageAsync(r,n,s,e,t,i);o!==void 0&&c.DownloadBlob(a,o),a.type!==e&&E.Warn(`DumpData: The requested mimeType '${e}' is not supported. The result has mimeType '${a.type}' instead.`);let f=await a.arrayBuffer();return p?f:`data:${e};base64,${b(f)}`}function D(n,s,r,e,o="image/png",t,p=!1,i=!1,a){t===void 0&&!e&&(t=""),y(n,s,r,o,t,p,i,a).then(f=>{e&&e(f)})}function T(){u&&(u?.then(n=>{n.canvas instanceof HTMLCanvasElement&&n.canvas.remove(),n.dumpEngine&&(n.dumpEngine.engine.dispose(),n.dumpEngine.renderer.dispose(),n.dumpEngine.wrapper.dispose())}),u=null)}var u,l,X,Y,G,U=S(()=>{R();L();F();O();B();P();_();W();u=null;l=class{static async EncodeImageAsync(s,r,e,o,t,p){let i=await M(),a=i.dumpEngine;a.engine.setSize(r,e,!0);let f=a.engine.createRawTexture(s,r,e,5,!1,!t,1);return a.renderer.setViewport(),a.renderer.applyEffectWrapper(a.wrapper),a.wrapper.effect._bindTexture("textureSampler",f),a.renderer.draw(),f.dispose(),await new Promise((g,m)=>{c.ToBlob(i.canvas,w=>{w?g(w):m(new Error("EncodeImageAsync: Failed to convert canvas to blob."))},o,p)})}};h([A],l,"EncodeImageAsync",null);X=l.EncodeImageAsync;Y={DumpData:D,DumpDataAsync:y,DumpFramebuffer:I,Dispose:T},G=()=>{c.DumpData=D,c.DumpDataAsync=y,c.DumpFramebuffer=I};G()});export{X as a,I as b,y as c,D as d,T as e,Y as f,U as g};
