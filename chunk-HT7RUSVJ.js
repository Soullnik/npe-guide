import{a as D,b as j}from"./chunk-5KO2HPOR.js";import{e as b,f as Q,g as R,h as q}from"./chunk-VKUYP47B.js";import{a as d,b as M,d as x}from"./chunk-2WAPFUUP.js";import{A as z,u as v,v as g,x as E,y as m,z as y}from"./chunk-HPFLS2LJ.js";import{a as F,b as B}from"./chunk-7CQUICK7.js";import{a as V,d as K}from"./chunk-A2QYPOYP.js";import{e as Y,h as S,z as U}from"./chunk-W4M4SCHI.js";import{e as C}from"./chunk-FAF55DAL.js";var _,w=C(()=>{"use strict";_=class i{constructor(e,n,r){this.name=e,this.from=n,this.to=r}clone(){return new i(this.name,this.from,this.to)}}});var W,H,Z,X,J,G,h,p,$=C(()=>{"use strict";z();x();U();K();w();j();q();B();Q();W=Object.freeze(new E(0,0,0,0)),H=Object.freeze(g.Zero()),Z=Object.freeze(v.Zero()),X=Object.freeze(R.Zero()),J=Object.freeze(d.Black()),G=Object.freeze(new M(0,0,0,0)),h={key:0,repeatCount:0,loopMode:2},p=class i{static _PrepareAnimation(e,n,r,o,t,s,a,c){let l;if(!isNaN(parseFloat(t))&&isFinite(t)?l=i.ANIMATIONTYPE_FLOAT:t instanceof E?l=i.ANIMATIONTYPE_QUATERNION:t instanceof g?l=i.ANIMATIONTYPE_VECTOR3:t instanceof v?l=i.ANIMATIONTYPE_VECTOR2:t instanceof d?l=i.ANIMATIONTYPE_COLOR3:t instanceof M?l=i.ANIMATIONTYPE_COLOR4:t instanceof R&&(l=i.ANIMATIONTYPE_SIZE),l==null)return null;let T=new i(e,n,r,l,a),u=[{frame:0,value:t},{frame:o,value:s}];return T.setKeys(u),c!==void 0&&T.setEasingFunction(c),T}static CreateAnimation(e,n,r,o){let t=new i(e+"Animation",e,r,n,i.ANIMATIONLOOPMODE_CONSTANT);return t.setEasingFunction(o),t}static CreateAndStartAnimation(e,n,r,o,t,s,a,c,l,T,u){let O=i._PrepareAnimation(e,r,o,t,s,a,c,l);return!O||(n.getScene&&(u=n.getScene()),!u)?null:u.beginDirectAnimation(n,[O],0,t,O.loopMode!==i.ANIMATIONLOOPMODE_CONSTANT,1,T)}static CreateAndStartHierarchyAnimation(e,n,r,o,t,s,a,c,l,T,u){let O=i._PrepareAnimation(e,o,t,s,a,c,l,T);return O?n.getScene().beginDirectHierarchyAnimation(n,r,[O],0,s,O.loopMode===1,1,u):null}static CreateMergeAndStartAnimation(e,n,r,o,t,s,a,c,l,T){let u=i._PrepareAnimation(e,r,o,t,s,a,c,l);return u?(n.animations.push(u),n.getScene().beginAnimation(n,0,t,u.loopMode===1,1,T)):null}static MakeAnimationAdditive(e,n,r,o=!1,t){let s;typeof n=="object"?s=n:s={referenceFrame:n??0,range:r,cloneOriginalAnimation:o,clonedAnimationName:t};let a=e;if(s.cloneOriginalAnimation&&(a=e.clone(),a.name=s.clonedAnimationName||a.name),!a._keys.length)return a;let c=s.referenceFrame&&s.referenceFrame>=0?s.referenceFrame:0,l=0,T=a._keys[0],u=a._keys.length-1,O=a._keys[u],f={referenceValue:T.value,referencePosition:y.Vector3[0],referenceQuaternion:y.Quaternion[0],referenceScaling:y.Vector3[1],keyPosition:y.Vector3[2],keyQuaternion:y.Quaternion[1],keyScaling:y.Vector3[3]},A=T.frame,P=O.frame;if(s.range){let I=a.getRange(s.range);I&&(A=I.from,P=I.to)}else A=s.fromFrame??A,P=s.toFrame??P;if(A!==T.frame&&(l=a.createKeyForFrame(A)),P!==O.frame&&(u=a.createKeyForFrame(P)),a._keys.length===1){let I=a._getKeyValue(a._keys[0]);f.referenceValue=I.clone?I.clone():I}else if(c<=T.frame){let I=a._getKeyValue(T.value);f.referenceValue=I.clone?I.clone():I}else if(c>=O.frame){let I=a._getKeyValue(O.value);f.referenceValue=I.clone?I.clone():I}else{h.key=0;let I=a._interpolate(c,h);f.referenceValue=I.clone?I.clone():I}a.dataType===i.ANIMATIONTYPE_QUATERNION?f.referenceValue.normalize().conjugateInPlace():a.dataType===i.ANIMATIONTYPE_MATRIX&&(f.referenceValue.decompose(f.referenceScaling,f.referenceQuaternion,f.referencePosition),f.referenceQuaternion.normalize().conjugateInPlace());let k=Number.MAX_VALUE,L=s.clipKeys?[]:null;for(let I=l;I<=u;I++){let N=a._keys[I];if((L||s.cloneOriginalAnimation)&&(N={frame:N.frame,value:N.value.clone?N.value.clone():N.value,inTangent:N.inTangent,outTangent:N.outTangent,interpolation:N.interpolation,lockedTangent:N.lockedTangent},L&&(k===Number.MAX_VALUE&&(k=N.frame),N.frame-=k,L.push(N))),!(I&&a.dataType!==i.ANIMATIONTYPE_FLOAT&&N.value===T.value))switch(a.dataType){case i.ANIMATIONTYPE_MATRIX:N.value.decompose(f.keyScaling,f.keyQuaternion,f.keyPosition),f.keyPosition.subtractInPlace(f.referencePosition),f.keyScaling.divideInPlace(f.referenceScaling),f.referenceQuaternion.multiplyToRef(f.keyQuaternion,f.keyQuaternion),m.ComposeToRef(f.keyScaling,f.keyQuaternion,f.keyPosition,N.value);break;case i.ANIMATIONTYPE_QUATERNION:f.referenceValue.multiplyToRef(N.value,N.value);break;case i.ANIMATIONTYPE_VECTOR2:case i.ANIMATIONTYPE_VECTOR3:case i.ANIMATIONTYPE_COLOR3:case i.ANIMATIONTYPE_COLOR4:N.value.subtractToRef(f.referenceValue,N.value);break;case i.ANIMATIONTYPE_SIZE:N.value.width-=f.referenceValue.width,N.value.height-=f.referenceValue.height;break;default:N.value-=f.referenceValue}}return L&&a.setKeys(L,!0),a}static TransitionTo(e,n,r,o,t,s,a,c=null,l=!0,T){if(a<=0)return r[e]=n,c&&c(),null;let u=t*(a/1e3);return s.setKeys(T??[{frame:0,value:r[e].clone?r[e].clone():r[e]},{frame:u,value:n}]),r.animations||(r.animations=[]),r.animations.push(s),o.beginAnimation(r,0,u,!1,1,c??void 0,void 0,l)}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(let e of this._runtimeAnimations)if(!e.isStopped())return!0;return!1}constructor(e,n,r,o,t,s){this.name=e,this.targetProperty=n,this.framePerSecond=r,this.dataType=o,this.loopMode=t,this.enableBlending=s,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this._coreAnimation=null,this.targetPropertyPath=n.split("."),this.dataType=o,this.loopMode=t===void 0?i.ANIMATIONLOOPMODE_CYCLE:t,this.uniqueId=i._UniqueIdGenerator++}toString(e){let n="Name: "+this.name+", property: "+this.targetProperty;if(n+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],n+=", nKeys: "+(this._keys?this._keys.length:"none"),n+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){n+=", Ranges: {";let r=!0;for(let o in this._ranges)r&&(n+=", ",r=!1),n+=o;n+="}"}return n}addEvent(e){this._events.push(e),this._events.sort((n,r)=>n.frame-r.frame)}removeEvents(e){for(let n=0;n<this._events.length;n++)this._events[n].frame===e&&(this._events.splice(n,1),n--)}getEvents(){return this._events}createRange(e,n,r){this._ranges[e]||(this._ranges[e]=new _(e,n,r))}deleteRange(e,n=!0){let r=this._ranges[e];if(r){if(n){let o=r.from,t=r.to;for(let s=this._keys.length-1;s>=0;s--)this._keys[s].frame>=o&&this._keys[s].frame<=t&&this._keys.splice(s,1)}this._ranges[e]=null}}getRange(e){return this._ranges[e]}getKeys(){return this._keys}getHighestFrame(){let e=0;for(let n=0,r=this._keys.length;n<r;n++)e<this._keys[n].frame&&(e=this._keys[n].frame);return e}getEasingFunction(){return this._easingFunction}setEasingFunction(e){this._easingFunction=e}floatInterpolateFunction(e,n,r){return Y(e,n,r)}floatInterpolateFunctionWithTangents(e,n,r,o,t){return S(e,n,r,o,t)}quaternionInterpolateFunction(e,n,r){return E.Slerp(e,n,r)}quaternionInterpolateFunctionWithTangents(e,n,r,o,t){return E.Hermite(e,n,r,o,t).normalize()}vector3InterpolateFunction(e,n,r){return g.Lerp(e,n,r)}vector3InterpolateFunctionWithTangents(e,n,r,o,t){return g.Hermite(e,n,r,o,t)}vector2InterpolateFunction(e,n,r){return v.Lerp(e,n,r)}vector2InterpolateFunctionWithTangents(e,n,r,o,t){return v.Hermite(e,n,r,o,t)}sizeInterpolateFunction(e,n,r){return R.Lerp(e,n,r)}color3InterpolateFunction(e,n,r){return d.Lerp(e,n,r)}color3InterpolateFunctionWithTangents(e,n,r,o,t){return d.Hermite(e,n,r,o,t)}color4InterpolateFunction(e,n,r){return M.Lerp(e,n,r)}color4InterpolateFunctionWithTangents(e,n,r,o,t){return M.Hermite(e,n,r,o,t)}_getKeyValue(e){return typeof e=="function"?e():e}evaluate(e){return h.key=0,this._interpolate(e,h)}_interpolate(e,n,r=!1){if(n.loopMode===i.ANIMATIONLOOPMODE_CONSTANT&&n.repeatCount>0)return n.highLimitValue.clone?n.highLimitValue.clone():n.highLimitValue;let o=this._keys,t;if(this._coreAnimation)t=this._coreAnimation._key;else{let A=o.length;for(t=n.key;t>=0&&e<o[t].frame;)--t;for(;t+1<=A-1&&e>=o[t+1].frame;)++t;if(n.key=t,t<0)return r?void 0:this._getKeyValue(o[0].value);if(t+1>A-1)return r?void 0:this._getKeyValue(o[A-1].value);this._key=t}let s=o[t],a=o[t+1];if(r&&(e===s.frame||e===a.frame))return;let c=this._getKeyValue(s.value),l=this._getKeyValue(a.value);if(s.interpolation===1)return a.frame>e?c:l;let T=s.outTangent!==void 0&&a.inTangent!==void 0,u=a.frame-s.frame,O=(e-s.frame)/u,f=s.easingFunction||this.getEasingFunction();switch(f&&(O=f.ease(O)),this.dataType){case i.ANIMATIONTYPE_FLOAT:{let A=T?this.floatInterpolateFunctionWithTangents(c,s.outTangent*u,l,a.inTangent*u,O):this.floatInterpolateFunction(c,l,O);switch(n.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:case i.ANIMATIONLOOPMODE_YOYO:return A;case i.ANIMATIONLOOPMODE_RELATIVE:case i.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(n.offsetValue??0)*n.repeatCount+A}break}case i.ANIMATIONTYPE_QUATERNION:{let A=T?this.quaternionInterpolateFunctionWithTangents(c,s.outTangent.scale(u),l,a.inTangent.scale(u),O):this.quaternionInterpolateFunction(c,l,O);switch(n.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:case i.ANIMATIONLOOPMODE_YOYO:return A;case i.ANIMATIONLOOPMODE_RELATIVE:case i.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return A.addInPlace((n.offsetValue||W).scale(n.repeatCount))}return A}case i.ANIMATIONTYPE_VECTOR3:{let A=T?this.vector3InterpolateFunctionWithTangents(c,s.outTangent.scale(u),l,a.inTangent.scale(u),O):this.vector3InterpolateFunction(c,l,O);switch(n.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:case i.ANIMATIONLOOPMODE_YOYO:return A;case i.ANIMATIONLOOPMODE_RELATIVE:case i.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return A.add((n.offsetValue||H).scale(n.repeatCount))}break}case i.ANIMATIONTYPE_VECTOR2:{let A=T?this.vector2InterpolateFunctionWithTangents(c,s.outTangent.scale(u),l,a.inTangent.scale(u),O):this.vector2InterpolateFunction(c,l,O);switch(n.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:case i.ANIMATIONLOOPMODE_YOYO:return A;case i.ANIMATIONLOOPMODE_RELATIVE:case i.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return A.add((n.offsetValue||Z).scale(n.repeatCount))}break}case i.ANIMATIONTYPE_SIZE:{switch(n.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:case i.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(c,l,O);case i.ANIMATIONLOOPMODE_RELATIVE:case i.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(c,l,O).add((n.offsetValue||X).scale(n.repeatCount))}break}case i.ANIMATIONTYPE_COLOR3:{let A=T?this.color3InterpolateFunctionWithTangents(c,s.outTangent.scale(u),l,a.inTangent.scale(u),O):this.color3InterpolateFunction(c,l,O);switch(n.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:case i.ANIMATIONLOOPMODE_YOYO:return A;case i.ANIMATIONLOOPMODE_RELATIVE:case i.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return A.add((n.offsetValue||J).scale(n.repeatCount))}break}case i.ANIMATIONTYPE_COLOR4:{let A=T?this.color4InterpolateFunctionWithTangents(c,s.outTangent.scale(u),l,a.inTangent.scale(u),O):this.color4InterpolateFunction(c,l,O);switch(n.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:case i.ANIMATIONLOOPMODE_YOYO:return A;case i.ANIMATIONLOOPMODE_RELATIVE:case i.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return A.add((n.offsetValue||G).scale(n.repeatCount))}break}case i.ANIMATIONTYPE_MATRIX:{switch(n.loopMode){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:case i.ANIMATIONLOOPMODE_YOYO:return i.AllowMatricesInterpolation?this.matrixInterpolateFunction(c,l,O,n.workValue):c;case i.ANIMATIONLOOPMODE_RELATIVE:case i.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return c}break}}return 0}matrixInterpolateFunction(e,n,r,o){return i.AllowMatrixDecomposeForInterpolation?o?(m.DecomposeLerpToRef(e,n,r,o),o):m.DecomposeLerp(e,n,r):o?(m.LerpToRef(e,n,r,o),o):m.Lerp(e,n,r)}clone(){let e=new i(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed,this._keys&&e.setKeys(this._keys),this._ranges){e._ranges={};for(let n in this._ranges){let r=this._ranges[n];r&&(e._ranges[n]=r.clone())}}return e}setKeys(e,n=!1){this._keys=n?e:e.slice(0)}createKeyForFrame(e){h.key=0;let n=this._interpolate(e,h,!0);if(!n)return this._keys[h.key].frame===e?h.key:h.key+1;let r={frame:e,value:n.clone?n.clone():n};return this._keys.splice(h.key+1,0,r),h.key+1}serialize(){let e={};e.name=this.name,e.property=this.targetProperty,e.framePerSecond=this.framePerSecond,e.dataType=this.dataType,e.loopBehavior=this.loopMode,e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed;let n=this.dataType;e.keys=[];let r=this.getKeys();for(let o=0;o<r.length;o++){let t=r[o],s={};switch(s.frame=t.frame,n){case i.ANIMATIONTYPE_FLOAT:s.values=[t.value],t.inTangent!==void 0&&s.values.push(t.inTangent),t.outTangent!==void 0&&(t.inTangent===void 0&&s.values.push(void 0),s.values.push(t.outTangent)),t.interpolation!==void 0&&(t.inTangent===void 0&&s.values.push(void 0),t.outTangent===void 0&&s.values.push(void 0),s.values.push(t.interpolation));break;case i.ANIMATIONTYPE_QUATERNION:case i.ANIMATIONTYPE_MATRIX:case i.ANIMATIONTYPE_VECTOR3:case i.ANIMATIONTYPE_COLOR3:case i.ANIMATIONTYPE_COLOR4:s.values=t.value.asArray(),t.inTangent!=null&&s.values.push(t.inTangent.asArray()),t.outTangent!=null&&(t.inTangent===void 0&&s.values.push(void 0),s.values.push(t.outTangent.asArray())),t.interpolation!==void 0&&(t.inTangent===void 0&&s.values.push(void 0),t.outTangent===void 0&&s.values.push(void 0),s.values.push(t.interpolation));break}e.keys.push(s)}e.ranges=[];for(let o in this._ranges){let t=this._ranges[o];if(!t)continue;let s={};s.name=o,s.from=t.from,s.to=t.to,e.ranges.push(s)}return e}static _UniversalLerp(e,n,r){let o=e.constructor;return o.Lerp?o.Lerp(e,n,r):o.Slerp?o.Slerp(e,n,r):e.toFixed?e*(1-r)+r*n:n}static Parse(e){let n=new i(e.name,e.property,e.framePerSecond,e.dataType,e.loopBehavior),r=e.dataType,o=[],t,s;for(e.enableBlending&&(n.enableBlending=e.enableBlending),e.blendingSpeed&&(n.blendingSpeed=e.blendingSpeed),s=0;s<e.keys.length;s++){let a=e.keys[s],c,l,T;switch(r){case i.ANIMATIONTYPE_FLOAT:t=a.values[0],a.values.length>=2&&(c=a.values[1]),a.values.length>=3&&(l=a.values[2]),a.values.length>=4&&(T=a.values[3]);break;case i.ANIMATIONTYPE_QUATERNION:if(t=E.FromArray(a.values),a.values.length>=8){let O=E.FromArray(a.values.slice(4,8));O.equals(E.Zero())||(c=O)}if(a.values.length>=12){let O=E.FromArray(a.values.slice(8,12));O.equals(E.Zero())||(l=O)}a.values.length>=13&&(T=a.values[12]);break;case i.ANIMATIONTYPE_MATRIX:t=m.FromArray(a.values),a.values.length>=17&&(T=a.values[16]);break;case i.ANIMATIONTYPE_COLOR3:t=d.FromArray(a.values),a.values[3]&&(c=d.FromArray(a.values[3])),a.values[4]&&(l=d.FromArray(a.values[4])),a.values[5]&&(T=a.values[5]);break;case i.ANIMATIONTYPE_COLOR4:t=M.FromArray(a.values),a.values[4]&&(c=M.FromArray(a.values[4])),a.values[5]&&(l=M.FromArray(a.values[5])),a.values[6]&&(T=M.FromArray(a.values[6]));break;case i.ANIMATIONTYPE_VECTOR3:default:t=g.FromArray(a.values),a.values[3]&&(c=g.FromArray(a.values[3])),a.values[4]&&(l=g.FromArray(a.values[4])),a.values[5]&&(T=a.values[5]);break}let u={};u.frame=a.frame,u.value=t,c!=null&&(u.inTangent=c),l!=null&&(u.outTangent=l),T!=null&&(u.interpolation=T),o.push(u)}if(n.setKeys(o),e.ranges)for(s=0;s<e.ranges.length;s++)t=e.ranges[s],n.createRange(t.name,t.from,t.to);return n}static AppendSerializedAnimations(e,n){b.AppendSerializedAnimations(e,n)}static async ParseFromFileAsync(e,n){return await new Promise((r,o)=>{let t=new F;t.addEventListener("readystatechange",()=>{if(t.readyState==4)if(t.status==200){let s=JSON.parse(t.responseText);if(s.animations&&(s=s.animations),s.length){let a=[];for(let c of s)a.push(this.Parse(c));r(a)}else{let a=this.Parse(s);e&&(a.name=e),r(a)}}else o("Unable to load the animation")}),t.open("GET",n),t.send()})}static async ParseFromSnippetAsync(e){return await new Promise((n,r)=>{let o=new F;o.addEventListener("readystatechange",()=>{if(o.readyState==4)if(o.status==200){let t=JSON.parse(JSON.parse(o.responseText).jsonPayload);if(t.animations){let s=JSON.parse(t.animations),a=[];for(let c of s.animations){let l=this.Parse(c);l.snippetId=e,a.push(l)}n(a)}else{let s=JSON.parse(t.animation),a=this.Parse(s);a.snippetId=e,n(a)}}else r("Unable to load the snippet "+e)}),o.open("GET",this.SnippetUrl+"/"+e.replace(/#/g,"/")),o.send()})}};p._UniqueIdGenerator=0;p.AllowMatricesInterpolation=!1;p.AllowMatrixDecomposeForInterpolation=!0;p.SnippetUrl="https://snippet.babylonjs.com";p.ANIMATIONTYPE_FLOAT=0;p.ANIMATIONTYPE_VECTOR3=1;p.ANIMATIONTYPE_QUATERNION=2;p.ANIMATIONTYPE_MATRIX=3;p.ANIMATIONTYPE_COLOR3=4;p.ANIMATIONTYPE_COLOR4=7;p.ANIMATIONTYPE_VECTOR2=5;p.ANIMATIONTYPE_SIZE=6;p.ANIMATIONLOOPMODE_RELATIVE=0;p.ANIMATIONLOOPMODE_CYCLE=1;p.ANIMATIONLOOPMODE_CONSTANT=2;p.ANIMATIONLOOPMODE_YOYO=4;p.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5;p.CreateFromSnippetAsync=p.ParseFromSnippetAsync;V("BABYLON.Animation",p);D._AnimationRangeFactory=(i,e,n)=>new _(i,e,n)});export{_ as a,w as b,W as c,H as d,Z as e,X as f,J as g,G as h,p as i,$ as j};
