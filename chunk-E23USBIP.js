import{c as F,d as ee}from"./chunk-2AUPWM7R.js";import{a as V,b as te}from"./chunk-MEUTOEEX.js";import{e as i}from"./chunk-FAF55DAL.js";function se(){if(!p){p=new Float32Array(l);let s=1/(l-1),e=s;for(let t=1;t<l;t++)p[t]=Math.exp(-11.512925464970227*(1-e)),e+=s}return p}function re(){if(!b){b=new Float32Array(l);let s=1/l,e=s;for(let t=0;t<l;t++)b[t]=1+Math.log10(e)/Math.log10(l),e+=s}return b}function H(s,e,t){m||(m=new Float32Array(l));let r;if(s==="linear")return C[0]=e,C[1]=t,C;if(s==="exponential")r=se();else if(s==="logarithmic")r=re();else throw new Error(`Unknown ramp shape: ${s}`);let n=Math.sign(t-e),o=Math.abs(t-e);if(n===1)for(let a=0;a<r.length;a++)m[a]=e+o*r[a];else{let a=l-1;for(let v=0;v<r.length;v++,a--)m[v]=e-o*(1-r[a])}return m}function le(s){return s.replace(/#/gm,"%23")}var ue,l,C,m,p,b,L=i(()=>{"use strict";ue=new RegExp("\\.(\\w{3,4})($|\\?)"),l=100,C=new Float32Array([0,0]),m=null,p=null,b=null});var ne,y,I=i(()=>{"use strict";L();ne=1e-6,y=class{constructor(e,t){this._rampEndTime=0,this._engine=e,this._param=t,this._targetValue=t.value}get isRamping(){return this._engine.currentTime<this._rampEndTime}get targetValue(){return this._targetValue}set targetValue(e){this.setTargetValue(e)}get value(){return this._param.value}dispose(){this._param=null,this._engine=null}setTargetValue(e,t=null){let r=typeof t?.shape=="string"?t.shape:"linear",n=this._engine.currentTime;if(r==="none"){this._param.cancelScheduledValues(0),this._param.value=this._targetValue=e,this._rampEndTime=n;return}let o=typeof t?.duration=="number"?Math.max(t.duration,this._engine.parameterRampDuration):this._engine.parameterRampDuration;if((o=Math.max(this._engine.parameterRampDuration,o))<ne){this._param.setValueAtTime(this._targetValue=e,n);return}this._param.cancelScheduledValues(0),this._param.setValueCurveAtTime(H(r,this._param.value,this._targetValue=e),n,o),this._rampEndTime=n+o}}});var N,j=i(()=>{"use strict";N=class{constructor(){this._createSubNodePromises={},this._isDisposed=!1,this._subNodes={},this._onSubNodeDisposed=e=>{let t=e;delete this._subNodes[t.name],this._onSubNodesChanged()}}callOnSubNode(e,t){let r=this.getSubNode(e);if(r){t(r);return}this._createSubNodePromisesResolvedAsync().then(()=>{let n=this.getSubNode(e);if(n){t(n);return}this.createAndAddSubNodeAsync(e).then(o=>{t(o)})})}createAndAddSubNodeAsync(e){var t;return(t=this._createSubNodePromises)[e]||(t[e]=this._createSubNode(e).then(r=>(this._addSubNode(r),r))),this._createSubNodePromises[e]}dispose(){this._isDisposed=!0;let e=Object.values(this._subNodes);for(let t of e)t.dispose();this._subNodes={},this._createSubNodePromises={}}getSubNode(e){return this._subNodes[e]??null}async removeSubNodeAsync(e){if(!e)return;await this._createSubNodePromisesResolvedAsync();let t=e.name;this._subNodes[t]&&delete this._subNodes[t],delete this._createSubNodePromises[t],this._onSubNodesChanged()}async _createSubNodePromisesResolvedAsync(){return await Promise.all(Object.values(this._createSubNodePromises))}_addSubNode(e){if(this._isDisposed){e.dispose();return}this._subNodes[e.name]=e,e.onDisposeObservable.addOnce(this._onSubNodeDisposed),this._onSubNodesChanged()}}});function W(s){return s.analyzerEnabled||s.analyzerFFTSize!==void 0||s.analyzerMinDecibels!==void 0||s.analyzerMaxDecibels!==void 0||s.analyzerSmoothing!==void 0}var u,g,A=i(()=>{"use strict";u={fftSize:2048,minDecibels:-100,maxDecibels:-30,smoothing:.8};g=class{get frequencyBinCount(){return this.fftSize/2}}});var oe,q,h,G=i(()=>{"use strict";ee();oe=(function(s){return s[s.HAS_INPUTS=1]="HAS_INPUTS",s[s.HAS_OUTPUTS=2]="HAS_OUTPUTS",s[s.HAS_INPUTS_AND_OUTPUTS=3]="HAS_INPUTS_AND_OUTPUTS",s})(oe||{}),q=class{constructor(e,t){this.onDisposeObservable=new F,this.engine=e,t&1&&(this._upstreamNodes=new Set),t&2&&(this._downstreamNodes=new Set)}dispose(){if(this._downstreamNodes){for(let e of Array.from(this._downstreamNodes))if(!this._disconnect(e))throw new Error("Disconnect failed");this._downstreamNodes.clear()}if(this._upstreamNodes){for(let e of Array.from(this._upstreamNodes))if(!e._disconnect(this))throw new Error("Disconnect failed");this._upstreamNodes.clear()}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()}_connect(e){return!this._downstreamNodes||this._downstreamNodes.has(e)||!e._onConnect(this)?!1:(this._downstreamNodes.add(e),!0)}_disconnect(e){return!this._downstreamNodes||!this._downstreamNodes.delete(e)?!1:e._onDisconnect(this)}_onConnect(e){return!this._upstreamNodes||this._upstreamNodes.has(e)?!1:(this._upstreamNodes.add(e),!0)}_onDisconnect(e){return this._upstreamNodes?.delete(e)??!1}},h=class extends q{constructor(e,t,r){super(t,r),this.onNameChangedObservable=new F,this._name=e}get name(){return this._name}set name(e){if(this._name===e)return;let t=this._name;this._name=e,this.onNameChangedObservable.notifyObservers({newName:e,oldName:t,node:this})}dispose(){super.dispose(),this.onNameChangedObservable.clear()}}});var _,E=i(()=>{"use strict";G();_=class extends h{constructor(e,t){super(e,t,3)}connect(e){if(!this._connect(e))throw new Error("Connect failed")}disconnect(e){if(!this._disconnect(e))throw new Error("Disconnect failed")}disconnectAll(){if(!this._downstreamNodes)throw new Error("Disconnect failed");let e=this._downstreamNodes.values();for(let t=e.next();!t.done;t=e.next())if(!this._disconnect(t.value))throw new Error("Disconnect failed")}}});function c(s){return s.getSubNode("Analyzer")}function f(s,e,t){s.callOnSubNode("Analyzer",r=>{r[e]=t})}var D,S=i(()=>{"use strict";A();E();D=class extends _{constructor(e){super("Analyzer",e)}setOptions(e){this.fftSize=e.analyzerFFTSize??u.fftSize,this.minDecibels=e.analyzerMinDecibels??u.minDecibels,this.maxDecibels=e.analyzerMaxDecibels??u.maxDecibels,this.smoothing=e.analyzerSmoothing??u.smoothing}}});function d(s){return s.getSubNode("Volume")}function k(s,e){return d(s)?.[e]??$[e]}var $,z,x=i(()=>{"use strict";E();$={volume:1},z=class extends _{constructor(e){super("Volume",e)}setOptions(e){this.setVolume(e.volume??$.volume,{shape:"none"})}}});async function J(s){return new O(s)}var O,K=i(()=>{"use strict";x();I();O=class extends z{constructor(e){super(e);let t=this.node=new GainNode(e._audioContext);this._volume=new y(e,t.gain)}dispose(){super.dispose(),this._volume.dispose()}get volume(){return this._volume.value}set volume(e){this.setVolume(e)}get _inNode(){return this.node}get _outNode(){return this.node}setVolume(e,t=null){this._volume.setTargetValue(e,t)}_connect(e){return super._connect(e)?(e._inNode&&this.node.connect(e._inNode),!0):!1}_disconnect(e){return super._disconnect(e)?(e._inNode&&this.node.disconnect(e._inNode),!0):!1}getClassName(){return"_VolumeWebAudioSubNode"}}});function U(){return P||(P=new Uint8Array),P}function M(){return T||(T=new Float32Array),T}var P,T,w,R=i(()=>{"use strict";te();A();S();P=null,T=null;w=class extends g{constructor(e){super(),this._fftSize=u.fftSize,this._maxDecibels=u.maxDecibels,this._minDecibels=u.minDecibels,this._smoothing=u.smoothing,this._subGraph=e}get fftSize(){return this._fftSize}set fftSize(e){this._fftSize=e,f(this._subGraph,"fftSize",e)}get isEnabled(){return c(this._subGraph)!==null}get minDecibels(){return this._minDecibels}set minDecibels(e){this._minDecibels=e,f(this._subGraph,"minDecibels",e)}get maxDecibels(){return this._maxDecibels}set maxDecibels(e){this._maxDecibels=e,f(this._subGraph,"maxDecibels",e)}get smoothing(){return this._smoothing}set smoothing(e){this._smoothing=e,f(this._subGraph,"smoothing",e)}dispose(){let e=c(this._subGraph);e&&(this._subGraph.removeSubNodeAsync(e),e.dispose())}async enableAsync(){c(this._subGraph)||await this._subGraph.createAndAddSubNodeAsync("Analyzer")}getByteFrequencyData(){let e=c(this._subGraph);return e?e.getByteFrequencyData():(V.Warn("AudioAnalyzer not enabled"),this.enableAsync(),U())}getFloatFrequencyData(){let e=c(this._subGraph);return e?e.getFloatFrequencyData():(V.Warn("AudioAnalyzer not enabled"),this.enableAsync(),M())}}});async function Q(s){return new B(s)}var B,X=i(()=>{"use strict";S();R();B=class extends D{constructor(e){super(e),this._byteFrequencyData=null,this._floatFrequencyData=null,this._analyzerNode=new AnalyserNode(e._audioContext)}get fftSize(){return this._analyzerNode.fftSize}set fftSize(e){e!==this._analyzerNode.fftSize&&(this._analyzerNode.fftSize=e,this._clearArrays())}get _inNode(){return this._analyzerNode}get minDecibels(){return this._analyzerNode.minDecibels}set minDecibels(e){this._analyzerNode.minDecibels=e}get maxDecibels(){return this._analyzerNode.maxDecibels}set maxDecibels(e){this._analyzerNode.maxDecibels=e}get smoothing(){return this._analyzerNode.smoothingTimeConstant}set smoothing(e){this._analyzerNode.smoothingTimeConstant=e}dispose(){super.dispose(),this._clearArrays(),this._byteFrequencyData=null,this._floatFrequencyData=null,this._analyzerNode.disconnect()}getClassName(){return"_WebAudioAnalyzerSubNode"}getByteFrequencyData(){return(!this._byteFrequencyData||this._byteFrequencyData.length===0)&&(this._byteFrequencyData=new Uint8Array(this._analyzerNode.frequencyBinCount)),this._analyzerNode.getByteFrequencyData(this._byteFrequencyData),this._byteFrequencyData}getFloatFrequencyData(){return(!this._floatFrequencyData||this._floatFrequencyData.length===0)&&(this._floatFrequencyData=new Float32Array(this._analyzerNode.frequencyBinCount)),this._analyzerNode.getFloatFrequencyData(this._floatFrequencyData),this._floatFrequencyData}_clearArrays(){this._byteFrequencyData?.set(U()),this._floatFrequencyData?.set(M())}}});var Y,ie=i(()=>{"use strict";j();S();x();A();K();X();Y=class extends N{constructor(e){super(),this._outputNode=null,this._owner=e}async initAsync(e){let t=W(e);if(t&&await this.createAndAddSubNodeAsync("Analyzer"),await this.createAndAddSubNodeAsync("Volume"),await this._createSubNodePromisesResolvedAsync(),t){let n=c(this);if(!n)throw new Error("No analyzer subnode.");n.setOptions(e)}let r=d(this);if(!r)throw new Error("No volume subnode.");if(r.setOptions(e),r.getClassName()!=="_VolumeWebAudioSubNode")throw new Error("Not a WebAudio subnode.");if(this._outputNode=r.node,this._outputNode&&this._downstreamNodes){let n=this._downstreamNodes.values();for(let o=n.next();!o.done;o=n.next()){let a=o.value._inNode;a&&this._outputNode.connect(a)}}}get _inNode(){return this._outputNode}get _outNode(){return this._outputNode}_createSubNode(e){switch(e){case"Analyzer":return Q(this._owner.engine);case"Volume":return J(this._owner.engine);default:throw new Error(`Unknown subnode name: ${e}`)}}_onSubNodesChanged(){let e=c(this),t=d(this);e&&t&&t.connect(e)}}});var Z,ae=i(()=>{"use strict";G();x();R();Z=class extends h{constructor(e,t,r){super(e,t,r),this._analyzer=null}get analyzer(){return this._analyzer??(this._analyzer=new w(this._subGraph))}get volume(){return k(this._subGraph,"volume")}set volume(e){let t=d(this._subGraph);if(!t)throw new Error("No volume subnode");t.volume=e}dispose(){super.dispose(),this._analyzer?.dispose(),this._analyzer=null,this._subGraph.dispose()}setVolume(e,t=null){let r=d(this._subGraph);if(!r)throw new Error("No volume subnode");r.setVolume(e,t)}}});export{ue as a,le as b,L as c,y as d,I as e,oe as f,q as g,h,G as i,_ as j,E as k,d as l,x as m,u as n,W as o,g as p,A as q,Z as r,ae as s,Y as t,ie as u};
