import{e as b,z as v}from"./chunk-W4M4SCHI.js";import{e as V}from"./chunk-FAF55DAL.js";function O(t){return t.split(" ").filter(o=>o!=="").map(o=>parseFloat(o))}function x(t,o,r){for(;r.length!==o;){let n=O(t.lines[t.index++]);r.push(...n)}}function w(t,o,r){let n=0,e=0,i=0,u=0,f=0,h=0;for(let s=0;s<t.numberOfHorizontalAngles-1;s++)if(r<t.horizontalAngles[s+1]||s===t.numberOfHorizontalAngles-2){e=s,i=t.horizontalAngles[s],u=t.horizontalAngles[s+1];break}for(let s=0;s<t.numberOfVerticalAngles-1;s++)if(o<t.verticalAngles[s+1]||s===t.numberOfVerticalAngles-2){n=s,f=t.verticalAngles[s],h=t.verticalAngles[s+1];break}let c=u-i,A=h-f;if(A===0)return 0;let g=c===0?0:(r-i)/c,m=(o-f)/A,d=c===0?e:e+1,l=b(t.candelaValues[e][n],t.candelaValues[d][n],g),a=b(t.candelaValues[e][n+1],t.candelaValues[d][n+1],g);return b(l,a,m)}function z(t){let n={lines:new TextDecoder("utf-8").decode(t).split(`
`),index:0},e={version:n.lines[0],candelaValues:[],horizontalAngles:[],verticalAngles:[],numberOfHorizontalAngles:0,numberOfVerticalAngles:0};for(n.index=1;n.lines.length>0&&!n.lines[n.index].includes("TILT=");)n.index++;n.lines[n.index].includes("INCLUDE"),n.index++;let i=O(n.lines[n.index++]);e.numberOfLights=i[0],e.lumensPerLamp=i[1],e.candelaMultiplier=i[2],e.numberOfVerticalAngles=i[3],e.numberOfHorizontalAngles=i[4],e.photometricType=i[5],e.unitsType=i[6],e.width=i[7],e.length=i[8],e.height=i[9];let u=O(n.lines[n.index++]);e.ballastFactor=u[0],e.fileGenerationType=u[1],e.inputWatts=u[2];for(let l=0;l<e.numberOfHorizontalAngles;l++)e.candelaValues[l]=[];x(n,e.numberOfVerticalAngles,e.verticalAngles),x(n,e.numberOfHorizontalAngles,e.horizontalAngles);for(let l=0;l<e.numberOfHorizontalAngles;l++)x(n,e.numberOfVerticalAngles,e.candelaValues[l]);let f=-1;for(let l=0;l<e.numberOfHorizontalAngles;l++)for(let a=0;a<e.numberOfVerticalAngles;a++)e.candelaValues[l][a]*=e.candelaValues[l][a]*e.candelaMultiplier*e.ballastFactor*e.fileGenerationType,f=Math.max(f,e.candelaValues[l][a]);if(f>0)for(let l=0;l<e.numberOfHorizontalAngles;l++)for(let a=0;a<e.numberOfVerticalAngles;a++)e.candelaValues[l][a]/=f;let h=180,c=h*2,A=c*h,g=new Float32Array(c*h),m=e.horizontalAngles[0],d=e.horizontalAngles[e.numberOfHorizontalAngles-1];for(let l=0;l<A;l++){let a=l%c,p=Math.floor(l/c);d-m!==0&&(a<m||a>=d)&&(a%=d*2,a>d&&(a=d*2-a)),g[p+a*h]=w(e,p,a)}return{width:c/2,height:1,data:g}}var T=V(()=>{"use strict";v()});var y,D=V(()=>{T();y=class{constructor(){this.supportCascades=!1}loadCubeData(){throw".ies not supported in Cube."}loadData(o,r,n){let e=new Uint8Array(o.buffer,o.byteOffset,o.byteLength),i=z(e);n(i.width,i.height,!!r.useMipMaps,!1,()=>{let u=r.getEngine();r.type=1,r.format=6,r._gammaSpace=!1,u._uploadDataToTextureDirectly(r,i.data)})}}});export{z as a,T as b,y as c,D as d};
