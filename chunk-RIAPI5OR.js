import{a as U,b as p}from"./chunk-EJMOGHUZ.js";import{a as D,b as F}from"./chunk-MEUTOEEX.js";import{e as m}from"./chunk-FAF55DAL.js";function N(e,s,t,i){switch(s){case 5120:{let r=e.getInt8(t);return i&&(r=Math.max(r/127,-1)),r}case 5121:{let r=e.getUint8(t);return i&&(r=r/255),r}case 5122:{let r=e.getInt16(t,!0);return i&&(r=Math.max(r/32767,-1)),r}case 5123:{let r=e.getUint16(t,!0);return i&&(r=r/65535),r}case 5124:return e.getInt32(t,!0);case 5125:return e.getUint32(t,!0);case 5126:return e.getFloat32(t,!0);default:throw new Error(`Invalid component type ${s}`)}}function L(e,s,t,i,r){switch(s){case 5120:{i&&(r=Math.round(r*127)),e.setInt8(t,r);break}case 5121:{i&&(r=Math.round(r*255)),e.setUint8(t,r);break}case 5122:{i&&(r=Math.round(r*32767)),e.setInt16(t,r,!0);break}case 5123:{i&&(r=Math.round(r*65535)),e.setUint16(t,r,!0);break}case 5124:{e.setInt32(t,r,!0);break}case 5125:{e.setUint32(t,r,!0);break}case 5126:{e.setFloat32(t,r,!0);break}default:throw new Error(`Invalid component type ${s}`)}}function g(e){switch(e){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${e}'`)}}function M(e){switch(e){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${e}'`)}}function E(e,s,t,i,r,f,u,h){let o=new Array(i),n=new Array(i);if(e instanceof Array){let a=s/4,l=t/4;for(let _=0;_<f;_+=i){for(let c=0;c<i;c++)o[c]=n[c]=e[a+c];h(n,_);for(let c=0;c<i;c++)o[c]!==n[c]&&(e[a+c]=n[c]);a+=l}}else{let a=ArrayBuffer.isView(e)?new DataView(e.buffer,e.byteOffset,e.byteLength):new DataView(e),l=g(r);for(let _=0;_<f;_+=i){for(let c=0,d=s;c<i;c++,d+=l)o[c]=n[c]=N(a,r,d,u);h(n,_);for(let c=0,d=s;c<i;c++,d+=l)o[c]!==n[c]&&L(a,r,d,u,n[c]);s+=t}}}function T(e,s,t,i,r,f,u,h){let o=s*g(t),n=u*s;if(t!==5126||r!==o){let a=new Float32Array(n);return E(e,i,r,s,t,n,f,(l,_)=>{for(let c=0;c<s;c++)a[_+c]=l[c]}),a}if(!(e instanceof Array||e instanceof Float32Array)||i!==0||e.length!==n)if(e instanceof Array){let a=i/4;return e.slice(a,a+n)}else{if(e instanceof ArrayBuffer)return new Float32Array(e,i,n);{let a=e.byteOffset+i;return(a&3)!==0&&(D.Warn("Float array must be aligned to 4-bytes border"),h=!0),h?new Float32Array(e.buffer.slice(a,a+n*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(e.buffer,a,n)}}return h?e.slice():e}function Y(e,s,t,i,r,f,u){let h=g(t),o=M(t),n=f*s;if(Array.isArray(e)){if((i&3)!==0||(r&3)!==0)throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");let d=i/4,b=r/4;if(d+(f-1)*b+s>e.length)throw new Error("Last accessed index is out of bounds.");if(b<s)throw new Error("Data stride cannot be smaller than the component size.");if(b!==s){let y=new o(n);return E(e,i,r,s,t,n,!1,(I,B)=>{for(let w=0;w<s;w++)y[B+w]=I[w]}),y}return new o(e.slice(d,d+n))}let a,l=i;if(e instanceof ArrayBuffer?a=e:(a=e.buffer,l+=e.byteOffset),l+(f-1)*r+s*h>a.byteLength)throw new Error("Last accessed byte is out of bounds.");let c=s*h;if(r<c)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(r!==c){let d=new o(n);return E(a,l,r,s,t,n,!1,(b,A)=>{for(let y=0;y<s;y++)d[A+y]=b[y]}),d}return h!==1&&(l&h-1)!==0&&(D.Warn("Array must be aligned to border of element size. Data will be copied."),u=!0),u?new o(a.slice(l,l+n*h)):new o(a,l,n)}function x(e,s,t,i,r,f,u,h){let o=s*g(t),n=u*s;if(h.length!==n)throw new Error("Output length is not valid");if(t!==5126||r!==o){E(e,i,r,s,t,n,f,(a,l)=>{for(let _=0;_<s;_++)h[l+_]=a[_]});return}if(e instanceof Array){let a=i/4;h.set(e,a)}else if(e instanceof ArrayBuffer){let a=new Float32Array(e,i,n);h.set(a)}else{let a=e.byteOffset+i;if((a&3)!==0){D.Warn("Float array must be aligned to 4-bytes border"),h.set(new Float32Array(e.buffer.slice(a,a+n*Float32Array.BYTES_PER_ELEMENT)));return}let l=new Float32Array(e.buffer,a,n);h.set(l)}}function W(e,s,t=0,i=0){if(Array.isArray(e)){for(let r=0;r<s;r++)if(e[t+r]-i>65535)return!0;return!1}return e.BYTES_PER_ELEMENT===4}function k(e,s){let t=s*e.BYTES_PER_ELEMENT;if((t&3)===0)return new e(s);t=t+3&-4;let i=new ArrayBuffer(t);return new e(i,0,s)}var K=m(()=>{"use strict";F()});var S,G,P=m(()=>{"use strict";p();F();K();S=class{get isDisposed(){return this._isDisposed}constructor(s,t,i,r=0,f=!1,u=!1,h=!1,o,n){this._isAlreadyOwned=!1,this._isDisposed=!1,s&&s.getScene?this._engine=s.getScene().getEngine():this._engine=s,this._updatable=i,this._instanced=u,this._divisor=o||1,this._label=n,t instanceof U?(this._data=null,this._buffer=t):(this._data=t,this._buffer=null),this.byteStride=h?r:r*Float32Array.BYTES_PER_ELEMENT,f||this.create()}createVertexBuffer(s,t,i,r,f,u=!1,h){let o=u?t:t*Float32Array.BYTES_PER_ELEMENT,n=r?u?r:r*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new G(this._engine,this,s,this._updatable,!0,n,f===void 0?this._instanced:f,o,i,void 0,void 0,!0,this._divisor||h)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(s=null){!s&&this._buffer||(s=s||this._data,s&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,s),this._data=s):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(s,this._label),this._data=s):this._buffer=this._engine.createVertexBuffer(s,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.capacity>0){this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.capacity,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.capacity,void 0,this._label);return}D.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(s){this.create(s)}updateDirectly(s,t,i,r=!1){this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,s,r?t:t*Float32Array.BYTES_PER_ELEMENT,i?i*this.byteStride:void 0),t===0&&i===void 0?this._data=s:this._data=null)}_increaseReferences(){if(this._buffer){if(!this._isAlreadyOwned){this._isAlreadyOwned=!0;return}this._buffer.references++}}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}},G=(()=>{class e{get isDisposed(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(t){let i=t!=0;this._instanceDivisor=t,i!==this._instanced&&(this._instanced=i,this._computeHashCode())}get _maxVerticesCount(){let t=this.getData();return t?Array.isArray(t)?t.length/(this.byteStride/4)-this.byteOffset/4:(t.byteLength-this.byteOffset)/this.byteStride:0}constructor(t,i,r,f,u,h,o,n,a,l,_=!1,c=!1,d=1,b=!1){this._isDisposed=!1;let A=!1;if(this.engine=t,typeof f=="object"&&f!==null?(A=f.updatable??!1,u=f.postponeInternalCreation,h=f.stride,o=f.instanced,n=f.offset,a=f.size,l=f.type,_=f.normalized??!1,c=f.useBytes??!1,d=f.divisor??1,b=f.takeBufferOwnership??!1,this._label=f.label):A=!!f,i instanceof S?(this._buffer=i,this._ownsBuffer=b):(this._buffer=new S(t,i,A,h,u,o,c,d,this._label),this._ownsBuffer=!0),this.uniqueId=e._Counter++,this._kind=r,l===void 0){let I=this.getData();this.type=I?e.GetDataType(I):e.FLOAT}else this.type=l;let y=g(this.type);c?(this._size=a||(h?h/y:e.DeduceStride(r)),this.byteStride=h||this._buffer.byteStride||this._size*y,this.byteOffset=n||0):(this._size=a||h||e.DeduceStride(r),this.byteStride=h?h*y:this._buffer.byteStride||this._size*y,this.byteOffset=(n||0)*y),this.normalized=_,this._instanced=o!==void 0?o:!1,this._instanceDivisor=o?d:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){this._buffer?._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(t,i){let r=this.getData();return r?T(r,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,t,i):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/g(this.type)}getOffset(){return this.byteOffset/g(this.type)}getSize(t=!1){return t?this._size*g(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(t){this._buffer.create(t),this._alignBuffer()}update(t){this._buffer.update(t),this._alignBuffer()}updateDirectly(t,i,r=!1){this._buffer.updateDirectly(t,i,void 0,r),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(t,i){E(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,t,this.normalized,(r,f)=>{for(let u=0;u<this._size;u++)i(r[u],f+u)})}_alignBuffer(){}static DeduceStride(t){switch(t){case e.UVKind:case e.UV2Kind:case e.UV3Kind:case e.UV4Kind:case e.UV5Kind:case e.UV6Kind:return 2;case e.NormalKind:case e.PositionKind:return 3;case e.ColorKind:case e.ColorInstanceKind:case e.MatricesIndicesKind:case e.MatricesIndicesExtraKind:case e.MatricesWeightsKind:case e.MatricesWeightsExtraKind:case e.TangentKind:return 4;default:throw new Error("Invalid kind '"+t+"'")}}static GetDataType(t){return t instanceof Int8Array?e.BYTE:t instanceof Uint8Array?e.UNSIGNED_BYTE:t instanceof Int16Array?e.SHORT:t instanceof Uint16Array?e.UNSIGNED_SHORT:t instanceof Int32Array?e.INT:t instanceof Uint32Array?e.UNSIGNED_INT:e.FLOAT}static GetTypeByteLength(t){return g(t)}static ForEach(t,i,r,f,u,h,o,n){E(t,i,r,f,u,h,o,(a,l)=>{for(let _=0;_<f;_++)n(a[_],l+_)})}static GetFloatData(t,i,r,f,u,h,o,n){return T(t,i,r,f,u,h,o,n)}}return e._Counter=0,e.BYTE=5120,e.UNSIGNED_BYTE=5121,e.SHORT=5122,e.UNSIGNED_SHORT=5123,e.INT=5124,e.UNSIGNED_INT=5125,e.FLOAT=5126,e.PositionKind="position",e.NormalKind="normal",e.TangentKind="tangent",e.UVKind="uv",e.UV2Kind="uv2",e.UV3Kind="uv3",e.UV4Kind="uv4",e.UV5Kind="uv5",e.UV6Kind="uv6",e.ColorKind="color",e.ColorInstanceKind="instanceColor",e.MatricesIndicesKind="matricesIndices",e.MatricesWeightsKind="matricesWeights",e.MatricesIndicesExtraKind="matricesIndicesExtra",e.MatricesWeightsExtraKind="matricesWeightsExtra",e})()});export{g as a,M as b,E as c,T as d,Y as e,x as f,W as g,k as h,K as i,S as j,G as k,P as l};
