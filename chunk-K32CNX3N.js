import{a as Z,b as Bt,k as M,l as L,p as Ot}from"./chunk-AOHWWFWO.js";import{A as tt,M as Lt}from"./chunk-A5VZ2EGJ.js";import{a as S,c as Rt}from"./chunk-4RWBSKZ4.js";import{j as w,z as xt}from"./chunk-W4M4SCHI.js";import{S as Y,T as bt,aa as q,ba as Ut,da as D,ea as wt}from"./chunk-XYWTDT3T.js";import{a as I,b as V}from"./chunk-MEUTOEEX.js";import{e as z}from"./chunk-FAF55DAL.js";function rt(o){let d=o.split("?")[0],t=d.lastIndexOf(".");return t>-1?d.substring(t).toLowerCase():""}var et=z(()=>{"use strict"});var at=z(()=>{"use strict";bt();V();Lt();Rt();wt();Ut();et();D.prototype._partialLoadFile=function(o,d,t,e,s=null){let f=u=>{t[d]=u,t._internalCount++,t._internalCount===6&&e(t)},p=(u,r)=>{s&&u&&s(u.status+" "+u.statusText,r)};this._loadFile(o,f,void 0,void 0,!0,p)};D.prototype._cascadeLoadFiles=function(o,d,t,e=null){let s=[];s._internalCount=0;for(let f=0;f<6;f++)this._partialLoadFile(t[f],f,s,d,e)};D.prototype._cascadeLoadImgs=function(o,d,t,e,s=null,f){let p=[];p._internalCount=0;for(let u=0;u<6;u++)this._partialLoadImg(e[u],u,p,o,d,t,s,f)};D.prototype._partialLoadImg=function(o,d,t,e,s,f,p=null,u){let r=S();tt(o,n=>{t[d]=n,t._internalCount++,e&&e.removePendingData(r),t._internalCount===6&&f&&f(s,t)},(n,c)=>{e&&e.removePendingData(r),p&&p(n,c)},e?e.offlineProvider:null,u),e&&e.addPendingData(r)};D.prototype.createCubeTextureBase=function(o,d,t,e,s=null,f=null,p,u=null,r=!1,A=0,a=0,n=null,c=null,i=null,_=!1,y=null){let l=n||new Y(this,7);l.isCube=!0,l.url=o,l.generateMipMaps=!e,l._lodGenerationScale=A,l._lodGenerationOffset=a,l._useSRGBBuffer=!!_&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!e),l!==n&&(l.label=o.substring(0,60)),this._doNotHandleContextLost||(l._extension=u,l._files=t,l._buffer=y);let F=o;this._transformTextureUrl&&!n&&(o=this._transformTextureUrl(o));let G=u??rt(o),B=q(G),R=(C,h)=>{l.dispose(),f?f(C,h):C&&I.Warn(C)},P=(C,h)=>{o===F?C&&R(C.status+" "+C.statusText,h):(I.Warn(`Failed to load ${o}, falling back to the ${F}`),this.createCubeTextureBase(F,d,t,!!e,s,R,p,u,r,A,a,l,c,i,_,y))};if(B)B.then(C=>{let h=m=>{c&&c(l,m),C.loadCubeData(m,l,r,s,(U,T)=>{R(U,T)})};y?h(y):t&&t.length===6?C.supportCascades?this._cascadeLoadFiles(d,m=>h(m.map(U=>new Uint8Array(U))),t,R):R("Textures type does not support cascades."):this._loadFile(o,m=>h(new Uint8Array(m)),void 0,d?d.offlineProvider||null:void 0,!0,P)});else{if(!t||t.length===0)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(d,l,(C,h)=>{i&&i(C,h)},t,R)}return this._internalTexturesCache.push(l),l}});function X(o){return o.charCodeAt(0)+(o.charCodeAt(1)<<8)+(o.charCodeAt(2)<<16)+(o.charCodeAt(3)<<24)}function It(o){return String.fromCharCode(o&255,o>>8&255,o>>16&255,o>>24&255)}var gt,nt,ot,st,ft,it,lt,ct,ut,$,At,pt,yt,mt,Pt,v,kt,Mt,Ft,Ct,j,dt,J,Gt,Ht,Dt,Tt,Et,Xt,Wt,Nt,er,zt=z(()=>{xt();V();Bt();Ot();at();gt=542327876,nt=131072,ot=512,st=4,ft=64,it=131072;lt=X("DXT1"),ct=X("DXT3"),ut=X("DXT5"),$=X("DX10"),At=113,pt=116,yt=2,mt=10,Pt=88,v=31,kt=0,Mt=1,Ft=2,Ct=3,j=4,dt=7,J=20,Gt=21,Ht=22,Dt=23,Tt=24,Et=25,Xt=26,Wt=28,Nt=32,er=(()=>{class o{static GetDDSInfo(t){let e=new Int32Array(t.buffer,t.byteOffset,v),s=new Int32Array(t.buffer,t.byteOffset,v+4),f=1;e[Ft]&nt&&(f=Math.max(1,e[dt]));let p=e[Gt],u=p===$?s[Nt]:0,r=0;switch(p){case At:r=2;break;case pt:r=1;break;case $:if(u===mt){r=2;break}if(u===yt){r=1;break}}return{width:e[j],height:e[Ct],mipmapCount:f,isFourCC:(e[J]&st)===st,isRGB:(e[J]&ft)===ft,isLuminance:(e[J]&it)===it,isCube:(e[Wt]&ot)===ot,isCompressed:p===lt||p===ct||p===ut,dxgiFormat:u,textureType:r}}static _GetHalfFloatAsFloatRGBAArrayBuffer(t,e,s,f,p,u){let r=new Float32Array(f),A=new Uint16Array(p,s),a=0;for(let n=0;n<e;n++)for(let c=0;c<t;c++){let i=(c+n*t)*4;r[a]=L(A[i]),r[a+1]=L(A[i+1]),r[a+2]=L(A[i+2]),o.StoreLODInAlphaChannel?r[a+3]=u:r[a+3]=L(A[i+3]),a+=4}return r}static _GetHalfFloatRGBAArrayBuffer(t,e,s,f,p,u){if(o.StoreLODInAlphaChannel){let r=new Uint16Array(f),A=new Uint16Array(p,s),a=0;for(let n=0;n<e;n++)for(let c=0;c<t;c++){let i=(c+n*t)*4;r[a]=A[i],r[a+1]=A[i+1],r[a+2]=A[i+2],r[a+3]=M(u),a+=4}return r}return new Uint16Array(p,s,f)}static _GetFloatRGBAArrayBuffer(t,e,s,f,p,u){if(o.StoreLODInAlphaChannel){let r=new Float32Array(f),A=new Float32Array(p,s),a=0;for(let n=0;n<e;n++)for(let c=0;c<t;c++){let i=(c+n*t)*4;r[a]=A[i],r[a+1]=A[i+1],r[a+2]=A[i+2],r[a+3]=u,a+=4}return r}return new Float32Array(p,s,f)}static _GetFloatAsHalfFloatRGBAArrayBuffer(t,e,s,f,p,u){let r=new Uint16Array(f),A=new Float32Array(p,s),a=0;for(let n=0;n<e;n++)for(let c=0;c<t;c++)r[a]=M(A[a]),r[a+1]=M(A[a+1]),r[a+2]=M(A[a+2]),o.StoreLODInAlphaChannel?r[a+3]=M(u):r[a+3]=M(A[a+3]),a+=4;return r}static _GetFloatAsUIntRGBAArrayBuffer(t,e,s,f,p,u){let r=new Uint8Array(f),A=new Float32Array(p,s),a=0;for(let n=0;n<e;n++)for(let c=0;c<t;c++){let i=(c+n*t)*4;r[a]=w(A[i])*255,r[a+1]=w(A[i+1])*255,r[a+2]=w(A[i+2])*255,o.StoreLODInAlphaChannel?r[a+3]=u:r[a+3]=w(A[i+3])*255,a+=4}return r}static _GetHalfFloatAsUIntRGBAArrayBuffer(t,e,s,f,p,u){let r=new Uint8Array(f),A=new Uint16Array(p,s),a=0;for(let n=0;n<e;n++)for(let c=0;c<t;c++){let i=(c+n*t)*4;r[a]=w(L(A[i]))*255,r[a+1]=w(L(A[i+1]))*255,r[a+2]=w(L(A[i+2]))*255,o.StoreLODInAlphaChannel?r[a+3]=u:r[a+3]=w(L(A[i+3]))*255,a+=4}return r}static _GetRGBAArrayBuffer(t,e,s,f,p,u,r,A,a){let n=new Uint8Array(f),c=new Uint8Array(p,s),i=0;for(let _=0;_<e;_++)for(let y=0;y<t;y++){let l=(y+_*t)*4;n[i]=c[l+u],n[i+1]=c[l+r],n[i+2]=c[l+A],n[i+3]=c[l+a],i+=4}return n}static _ExtractLongWordOrder(t){return t===0||t===255||t===-16777216?0:1+o._ExtractLongWordOrder(t>>8)}static _GetRGBArrayBuffer(t,e,s,f,p,u,r,A){let a=new Uint8Array(f),n=new Uint8Array(p,s),c=0;for(let i=0;i<e;i++)for(let _=0;_<t;_++){let y=(_+i*t)*3;a[c]=n[y+u],a[c+1]=n[y+r],a[c+2]=n[y+A],c+=3}return a}static _GetLuminanceArrayBuffer(t,e,s,f,p){let u=new Uint8Array(f),r=new Uint8Array(p,s),A=0;for(let a=0;a<e;a++)for(let n=0;n<t;n++){let c=n+a*t;u[A]=r[c],A++}return u}static UploadDDSLevels(t,e,s,f,p,u,r=-1,A,a=!0){let n=null;f.sphericalPolynomial&&(n=[]);let c=!!t.getCaps().s3tc;e.generateMipMaps=p;let i=new Int32Array(s.buffer,s.byteOffset,v),_,y,l,F=0,G,B,R,P,C=0,h=1;if(i[kt]!==gt){I.Error("Invalid magic number in DDS header");return}if(!f.isFourCC&&!f.isRGB&&!f.isLuminance){I.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");return}if(f.isCompressed&&!c){I.Error("Compressed textures are not supported on this platform.");return}let m=i[Ht];G=i[Mt]+4;let U=!1;if(f.isFourCC)switch(_=i[Gt],_){case lt:h=8,C=33777;break;case ct:h=16,C=33778;break;case ut:h=16,C=33779;break;case At:U=!0,m=64;break;case pt:U=!0,m=128;break;case $:{G+=20;let b=!1;switch(f.dxgiFormat){case mt:U=!0,m=64,b=!0;break;case yt:U=!0,m=128,b=!0;break;case Pt:f.isRGB=!0,f.isFourCC=!1,m=32,b=!0;break}if(b)break}default:I.Error(["Unsupported FourCC code:",It(_)]);return}let T=o._ExtractLongWordOrder(i[Dt]),K=o._ExtractLongWordOrder(i[Tt]),Q=o._ExtractLongWordOrder(i[Et]),_t=o._ExtractLongWordOrder(i[Xt]);U&&(C=t._getRGBABufferInternalSizedFormat(f.textureType)),R=1,i[Ft]&nt&&p!==!1&&(R=Math.max(1,i[dt]));let ht=A||0,H=t.getCaps();for(let b=ht;b<u;b++){for(y=i[j],l=i[Ct],P=0;P<R;++P){if(r===-1||r===P){let x=r===-1?P:0;if(!f.isCompressed&&f.isFourCC){e.format=5,F=y*l*4;let O=null;if(t._badOS||t._badDesktopOS||!H.textureHalfFloat&&!H.textureFloat)m===128?(O=o._GetFloatAsUIntRGBAArrayBuffer(y,l,s.byteOffset+G,F,s.buffer,x),n&&x==0&&n.push(o._GetFloatRGBAArrayBuffer(y,l,s.byteOffset+G,F,s.buffer,x))):m===64&&(O=o._GetHalfFloatAsUIntRGBAArrayBuffer(y,l,s.byteOffset+G,F,s.buffer,x),n&&x==0&&n.push(o._GetHalfFloatAsFloatRGBAArrayBuffer(y,l,s.byteOffset+G,F,s.buffer,x))),e.type=0;else{let E=H.textureFloat&&(a&&H.textureFloatLinearFiltering||!a),W=H.textureHalfFloat&&(a&&H.textureHalfFloatLinearFiltering||!a),N=(m===128||m===64&&!W)&&E?1:(m===64||m===128&&!E)&&W?2:0,k,g=null;switch(m){case 128:{switch(N){case 1:k=o._GetFloatRGBAArrayBuffer,g=null;break;case 2:k=o._GetFloatAsHalfFloatRGBAArrayBuffer,g=o._GetFloatRGBAArrayBuffer;break;case 0:k=o._GetFloatAsUIntRGBAArrayBuffer,g=o._GetFloatRGBAArrayBuffer;break}break}default:{switch(N){case 1:k=o._GetHalfFloatAsFloatRGBAArrayBuffer,g=null;break;case 2:k=o._GetHalfFloatRGBAArrayBuffer,g=o._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:k=o._GetHalfFloatAsUIntRGBAArrayBuffer,g=o._GetHalfFloatAsFloatRGBAArrayBuffer;break}break}}e.type=N,O=k(y,l,s.byteOffset+G,F,s.buffer,x),n&&x==0&&n.push(g?g(y,l,s.byteOffset+G,F,s.buffer,x):O)}O&&t._uploadDataToTextureDirectly(e,O,b,x)}else if(f.isRGB)e.type=0,m===24?(e.format=4,F=y*l*3,B=o._GetRGBArrayBuffer(y,l,s.byteOffset+G,F,s.buffer,T,K,Q),t._uploadDataToTextureDirectly(e,B,b,x)):(e.format=5,F=y*l*4,B=o._GetRGBAArrayBuffer(y,l,s.byteOffset+G,F,s.buffer,T,K,Q,_t),t._uploadDataToTextureDirectly(e,B,b,x));else if(f.isLuminance){let O=t._getUnpackAlignement(),E=y;F=Math.floor((y+O-1)/O)*O*(l-1)+E,B=o._GetLuminanceArrayBuffer(y,l,s.byteOffset+G,F,s.buffer),e.format=1,e.type=0,t._uploadDataToTextureDirectly(e,B,b,x)}else F=Math.max(4,y)/4*Math.max(4,l)/4*h,B=new Uint8Array(s.buffer,s.byteOffset+G,F),e.type=0,t._uploadCompressedDataToTextureDirectly(e,C,y,l,B,b,x)}G+=m?y*l*(m/8):F,y*=.5,l*=.5,y=Math.max(1,y),l=Math.max(1,l)}if(A!==void 0)break}n&&n.length>0?f.sphericalPolynomial=Z.ConvertCubeMapToSphericalPolynomial({size:i[j],right:n[0],left:n[1],up:n[2],down:n[3],front:n[4],back:n[5],format:5,type:1,gammaSpace:!1}):f.sphericalPolynomial=void 0}}return o.StoreLODInAlphaChannel=!1,o})()});export{rt as a,et as b,at as c,er as d,zt as e};
