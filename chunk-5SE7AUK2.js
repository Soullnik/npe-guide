import{d,e as T,j as f,k as I,l as U,m as ot,t as W,u as it}from"./chunk-E23USBIP.js";import{A as C,v as a,x as l,y as w}from"./chunk-HPFLS2LJ.js";import{g as G,h as et}from"./chunk-TTEXIRIC.js";import{e as s}from"./chunk-FAF55DAL.js";function E(e){return e.spatialEnabled||e.spatialAutoUpdate!==void 0||e.spatialConeInnerAngle!==void 0||e.spatialConeOuterAngle!==void 0||e.spatialConeOuterVolume!==void 0||e.spatialDistanceModel!==void 0||e.spatialMaxDistance!==void 0||e.spatialMinDistance!==void 0||e.spatialMinUpdateTime!==void 0||e.spatialOrientation!==void 0||e.spatialPanningModel!==void 0||e.spatialPosition!==void 0||e.spatialRolloffFactor!==void 0||e.spatialRotation!==void 0||e.spatialRotationQuaternion!==void 0}var i,g,m=s(()=>{"use strict";C();i={coneInnerAngle:6.28318530718,coneOuterAngle:6.28318530718,coneOuterVolume:0,distanceModel:"linear",maxDistance:1e4,minDistance:1,orientation:a.Right(),panningModel:"equalpower",position:a.Zero(),rolloffFactor:1,rotation:a.Zero(),rotationQuaternion:new l};g=class{}});function Z(e){return e.stereoEnabled||e.stereoPan!==void 0}var N,A,S=s(()=>{"use strict";N={pan:0};A=class{}});function F(e){return e.getSubNode("Stereo")}function q(e,t,o){e.callOnSubNode("Stereo",n=>{n[t]=o})}var x,O=s(()=>{"use strict";I();S();x=class extends f{constructor(t){super("Stereo",t)}setOptions(t){this.pan=t.stereoPan??N.pan}}});var B,nt=s(()=>{"use strict";S();O();B=class extends A{constructor(t){super(),this._pan=N.pan,this._subGraph=t}get pan(){return this._pan}set pan(t){this._pan=t,q(this._subGraph,"pan",t)}}});var D,X=s(()=>{"use strict";C();D=class{constructor(t){this._attachmentType=3,this._position=new a,this._rotationQuaternion=new l,this._sceneNode=null,this._useBoundingBox=!1,this.dispose=()=>{this.detach()},this._spatialAudioNode=t}get isAttached(){return this._sceneNode!==null}attach(t,o,n){this._sceneNode!==t&&(this.detach(),t&&(this._attachmentType=n,this._sceneNode=t,this._sceneNode.onDisposeObservable.add(this.dispose),this._useBoundingBox=o))}detach(){this._sceneNode?.onDisposeObservable.removeCallback(this.dispose),this._sceneNode=null}update(){this._attachmentType&1&&(this._useBoundingBox&&this._sceneNode.getBoundingInfo?this._position.copyFrom(this._sceneNode.getBoundingInfo().boundingBox.centerWorld):this._sceneNode?.getWorldMatrix().getTranslationToRef(this._position),this._spatialAudioNode.position.copyFrom(this._position),this._spatialAudioNode._updatePosition()),this._attachmentType&2&&(this._sceneNode?.getWorldMatrix().decompose(void 0,this._rotationQuaternion),this._spatialAudioNode.rotationQuaternion.copyFrom(this._rotationQuaternion),this._spatialAudioNode._updateRotation())}}});function r(e){return e.getSubNode("Spatial")}function h(e,t,o){e.callOnSubNode("Spatial",n=>{n[t]=o})}var b,y=s(()=>{"use strict";X();m();I();b=class extends f{constructor(t){super("Spatial",t),this._attacherComponent=null}get isAttached(){return this._attacherComponent!==null&&this._attacherComponent.isAttached}attach(t,o,n){this.detach(),this._attacherComponent||(this._attacherComponent=new D(this)),this._attacherComponent.attach(t,o,n)}detach(){this._attacherComponent?.detach()}dispose(){super.dispose(),this._attacherComponent?.dispose(),this._attacherComponent=null}setOptions(t){this.coneInnerAngle=t.spatialConeInnerAngle??i.coneInnerAngle,this.coneOuterAngle=t.spatialConeOuterAngle??i.coneOuterAngle,this.coneOuterVolume=t.spatialConeOuterVolume??i.coneOuterVolume,this.distanceModel=t.spatialDistanceModel??i.distanceModel,this.maxDistance=t.spatialMaxDistance??i.maxDistance,this.minDistance=t.spatialMinDistance??i.minDistance,this.orientation=t.spatialOrientation??i.orientation,this.panningModel=t.spatialPanningModel??i.panningModel,this.rolloffFactor=t.spatialRolloffFactor??i.rolloffFactor,t.spatialPosition&&(this.position=t.spatialPosition.clone()),t.spatialRotationQuaternion?this.rotationQuaternion=t.spatialRotationQuaternion.clone():t.spatialRotation?this.rotation=t.spatialRotation.clone():this.rotationQuaternion=i.rotationQuaternion.clone(),this.update()}update(){this.isAttached?this._attacherComponent?.update():(this._updatePosition(),this._updateRotation())}}});function H(e){return e*Math.PI/180}function k(e){return e*180/Math.PI}async function z(e){return new P(e)}var Y,R,P,$=s(()=>{"use strict";C();y();m();T();Y=w.Zero(),R=new l;P=class extends b{constructor(t){super(t),this._lastOrientation=a.Zero(),this._lastPosition=a.Zero(),this._lastRotation=a.Zero(),this._lastRotationQuaternion=new l,this.orientation=i.orientation.clone(),this.position=i.position.clone(),this.rotation=i.rotation.clone(),this.rotationQuaternion=i.rotationQuaternion.clone(),this.node=new PannerNode(t._audioContext),this._orientationX=new d(t,this.node.orientationX),this._orientationY=new d(t,this.node.orientationY),this._orientationZ=new d(t,this.node.orientationZ),this._positionX=new d(t,this.node.positionX),this._positionY=new d(t,this.node.positionY),this._positionZ=new d(t,this.node.positionZ)}dispose(){super.dispose(),this._orientationX.dispose(),this._orientationY.dispose(),this._orientationZ.dispose(),this._positionX.dispose(),this._positionY.dispose(),this._positionZ.dispose(),this.node.disconnect()}get coneInnerAngle(){return H(this.node.coneInnerAngle)}set coneInnerAngle(t){this.node.coneInnerAngle=k(t)}get coneOuterAngle(){return H(this.node.coneOuterAngle)}set coneOuterAngle(t){this.node.coneOuterAngle=k(t)}get coneOuterVolume(){return this.node.coneOuterGain}set coneOuterVolume(t){this.node.coneOuterGain=t}get distanceModel(){return this.node.distanceModel}set distanceModel(t){this.node.distanceModel=t;let o=this.node.maxDistance;this.node.maxDistance=o+.001,this.node.maxDistance=o}get minDistance(){return this.node.refDistance}set minDistance(t){this.node.refDistance=t}get maxDistance(){return this.node.maxDistance}set maxDistance(t){this.node.maxDistance=t}get panningModel(){return this.node.panningModel}set panningModel(t){this.node.panningModel=t}get rolloffFactor(){return this.node.rolloffFactor}set rolloffFactor(t){this.node.rolloffFactor=t}get _inNode(){return this.node}get _outNode(){return this.node}_updatePosition(){this._lastPosition.equalsWithEpsilon(this.position)||(this._positionX.targetValue=this.position.x,this._positionY.targetValue=this.position.y,this._positionZ.targetValue=this.position.z,this._lastPosition.copyFrom(this.position))}_updateRotation(){let t=!1;if(!this._lastRotationQuaternion.equalsWithEpsilon(this.rotationQuaternion))R.copyFrom(this.rotationQuaternion),this._lastRotationQuaternion.copyFrom(this.rotationQuaternion),t=!0;else if(!this._lastRotation.equalsWithEpsilon(this.rotation))l.FromEulerAnglesToRef(this.rotation.x,this.rotation.y,this.rotation.z,R),this._lastRotation.copyFrom(this.rotation),t=!0;else if(this._lastOrientation.equalsWithEpsilon(this.orientation))return;t&&(w.FromQuaternionToRef(R,Y),a.TransformNormalToRef(a.RightReadOnly,Y,this.orientation)),this._orientationX.targetValue=this.orientation.x,this._orientationY.targetValue=this.orientation.y,this._orientationZ.targetValue=this.orientation.z}_connect(t){return super._connect(t)?(t._inNode&&this.node.connect(t._inNode),!0):!1}_disconnect(t){return super._disconnect(t)?(t._inNode&&this.node.disconnect(t._inNode),!0):!1}getClassName(){return"_SpatialWebAudioSubNode"}}});async function j(e){return new V(e)}var V,J=s(()=>{"use strict";O();T();V=class extends x{constructor(t){super(t),this.node=new StereoPannerNode(t._audioContext),this._pan=new d(t,this.node.pan)}dispose(){super.dispose(),this._pan.dispose()}get pan(){return this._pan.targetValue}set pan(t){this._pan.targetValue=t}get _inNode(){return this.node}get _outNode(){return this.node}getClassName(){return"_StereoWebAudioSubNode"}_connect(t){return super._connect(t)?(t._inNode&&this.node.connect(t._inNode),!0):!1}_disconnect(t){return super._disconnect(t)?(t._inNode&&this.node.disconnect(t._inNode),!0):!1}}});var K,st=s(()=>{"use strict";y();O();ot();m();S();$();J();it();K=class extends W{constructor(){super(...arguments),this._rootNode=null,this._inputNode=null}async initAsync(t){await super.initAsync(t);let o=!1,n=!1;(o=E(t))&&await this.createAndAddSubNodeAsync("Spatial"),(n=Z(t))&&await this.createAndAddSubNodeAsync("Stereo"),await this._createSubNodePromisesResolvedAsync(),o&&r(this)?.setOptions(t),n&&F(this)?.setOptions(t)}get _inNode(){return this._inputNode}_createSubNode(t){try{return super._createSubNode(t)}catch{}switch(t){case"Spatial":return z(this._owner.engine);case"Stereo":return j(this._owner.engine);default:throw new Error(`Unknown subnode name: ${t}`)}}_onSubNodesChanged(){super._onSubNodesChanged();let t=r(this),o=F(this),n=U(this);if(t&&t.getClassName()!=="_SpatialWebAudioSubNode")throw new Error("Not a WebAudio subnode.");if(o&&o.getClassName()!=="_StereoWebAudioSubNode")throw new Error("Not a WebAudio subnode.");if(n&&n.getClassName()!=="_VolumeWebAudioSubNode")throw new Error("Not a WebAudio subnode.");t&&(t.disconnectAll(),n&&t.connect(n)),o&&(o.disconnectAll(),n&&o.connect(n)),t&&o?(this._rootNode=new GainNode(this._owner.engine._audioContext),this._rootNode.connect(t._outNode),this._rootNode.connect(o._outNode)):(this._rootNode?.disconnect(),this._rootNode=null);let p=null,u=null;if(this._rootNode?u=this._rootNode:(t?p=t:o?p=o:n&&(p=n),u=p?.node??null),this._inputNode!==u){if(this._inputNode&&this._upstreamNodes){let c=this._upstreamNodes.values();for(let _=c.next();!_.done;_=c.next())_.value._outNode?.disconnect(this._inputNode)}if(this._inputNode=u,u&&this._upstreamNodes){let c=this._upstreamNodes.values();for(let _=c.next();!_.done;_=c.next())_.value._outNode?.connect(u)}}}}});var M,L=s(()=>{"use strict";y();m();M=class extends g{constructor(t){super(),this._coneInnerAngle=i.coneInnerAngle,this._coneOuterAngle=i.coneOuterAngle,this._coneOuterVolume=i.coneOuterVolume,this._distanceModel=i.distanceModel,this._maxDistance=i.maxDistance,this._minDistance=i.minDistance,this._panningModel=i.panningModel,this._rolloffFactor=i.rolloffFactor;let o=r(t);o?(this._orientation=o.orientation.clone(),this._position=o.position.clone(),this._rotation=o.rotation.clone(),this._rotationQuaternion=o.rotationQuaternion.clone()):(this._orientation=i.orientation.clone(),this._position=i.position.clone(),this._rotation=i.rotation.clone(),this._rotationQuaternion=i.rotationQuaternion.clone(),t.createAndAddSubNodeAsync("Spatial")),this._subGraph=t}dispose(){this._subGraph.removeSubNodeAsync(r(this._subGraph))}get coneInnerAngle(){return this._coneInnerAngle}set coneInnerAngle(t){this._coneInnerAngle=t,h(this._subGraph,"coneInnerAngle",t)}get coneOuterAngle(){return this._coneOuterAngle}set coneOuterAngle(t){this._coneOuterAngle=t,h(this._subGraph,"coneOuterAngle",t)}get coneOuterVolume(){return this._coneOuterVolume}set coneOuterVolume(t){this._coneOuterVolume=t,h(this._subGraph,"coneOuterVolume",t)}get distanceModel(){return this._distanceModel}set distanceModel(t){this._distanceModel=t,h(this._subGraph,"distanceModel",t)}get isAttached(){return this._subGraph.getSubNode("Spatial")?.isAttached??!1}get maxDistance(){return this._maxDistance}set maxDistance(t){t<=0&&(t=1e-6),this._maxDistance=t,h(this._subGraph,"maxDistance",t)}get minDistance(){return this._minDistance}set minDistance(t){this._minDistance=t,h(this._subGraph,"minDistance",t)}get orientation(){return this._orientation}set orientation(t){this._orientation=t,this._updateRotation()}get panningModel(){return this._panningModel}set panningModel(t){this._panningModel=t,h(this._subGraph,"panningModel",t)}get position(){return this._position}set position(t){this._position=t,this._updatePosition()}get rolloffFactor(){return this._rolloffFactor}set rolloffFactor(t){this._rolloffFactor=t,h(this._subGraph,"rolloffFactor",t)}get rotation(){return this._rotation}set rotation(t){this._rotation=t,this._updateRotation()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(t){this._rotationQuaternion=t,this._updateRotation()}attach(t,o=!1,n=3){r(this._subGraph)?.attach(t,o,n)}detach(){r(this._subGraph)?.detach()}update(){let t=r(this._subGraph);t&&(t.isAttached?t.update():(this._updatePosition(t),this._updateRotation(t)))}_updatePosition(t=null){if(!t&&(t=r(this._subGraph),!t))return;t.position.equalsWithEpsilon(this._position)||(t.position.copyFrom(this._position),t._updatePosition())}_updateRotation(t=null){!t&&(t=r(this._subGraph),!t)||(t.rotationQuaternion.equalsWithEpsilon(this._rotationQuaternion)?t.rotation.equalsWithEpsilon(this._rotation)?t.orientation.equalsWithEpsilon(this._orientation)||(t.orientation.copyFrom(this._orientation),t._updateRotation(),this._rotation.copyFrom(t.rotation),this._rotationQuaternion.copyFrom(t.rotationQuaternion)):(t.rotation.copyFrom(this._rotation),t._updateRotation(),this._orientation.copyFrom(t.orientation),this._rotationQuaternion.copyFrom(t.rotationQuaternion)):(t.rotationQuaternion.copyFrom(this._rotationQuaternion),t._updateRotation(),this._orientation.copyFrom(t.orientation),this._rotation.copyFrom(t.rotation)))}}});var Q,v=s(()=>{"use strict";et();Q=class{constructor(t,o,n){if(this._autoUpdate=!0,this._lastUpdateTime=0,this.minUpdateTime=0,!o)return;this.minUpdateTime=n;let p=()=>{if(!this._autoUpdate)return;let u=!1;if(0<this.minUpdateTime){let c=G.Now;this._lastUpdateTime&&c-this._lastUpdateTime<this.minUpdateTime&&(u=!0),this._lastUpdateTime=c}u||t.update(),requestAnimationFrame(p)};requestAnimationFrame(p)}dispose(){this._autoUpdate=!1}}});var tt,at=s(()=>{"use strict";L();v();tt=class extends M{constructor(t,o,n){super(t),this._updaterComponent=new Q(this,o,n)}get minUpdateTime(){return this._updaterComponent.minUpdateTime}set minUpdateTime(t){this._updaterComponent.minUpdateTime=t}dispose(){super.dispose(),this._updaterComponent.dispose(),this._updaterComponent=null}}});export{D as a,X as b,Q as c,v as d,i as e,E as f,g,m as h,N as i,Z as j,A as k,S as l,B as m,nt as n,K as o,st as p,tt as q,at as r};
